---
title: 在 DataGridView 控件中使用新记录行
ms.date: 03/30/2017
helpviewer_keywords:
- DataGridView control [Windows Forms], adding rows for new records
- rows [Windows Forms], new records
- DataGridView control [Windows Forms], data entry
ms.assetid: 6110f1ea-9794-442c-a98a-f104a1feeaf4
ms.openlocfilehash: 2fcd35f8c4d04909cdbc26f6a4293fdd570385b8
ms.sourcegitcommit: 9f6df084c53a3da0ea657ed0d708a72213683084
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/09/2020
ms.locfileid: "96973108"
---
# <a name="using-the-row-for-new-records-in-the-windows-forms-datagridview-control"></a><span data-ttu-id="ed876-102">在 Windows 窗体 DataGridView 控件中使用新记录行</span><span class="sxs-lookup"><span data-stu-id="ed876-102">Using the Row for New Records in the Windows Forms DataGridView Control</span></span>
<span data-ttu-id="ed876-103">当使用在 <xref:System.Windows.Forms.DataGridView> 应用程序中编辑数据时，通常需要为用户提供将新数据行添加到数据存储区的能力。</span><span class="sxs-lookup"><span data-stu-id="ed876-103">When you use a <xref:System.Windows.Forms.DataGridView> for editing data in your application, you will often want to give your users the ability to add new rows of data to the data store.</span></span> <span data-ttu-id="ed876-104"><xref:System.Windows.Forms.DataGridView>控件通过为新记录（始终显示为最后一行）提供一行来支持此功能。</span><span class="sxs-lookup"><span data-stu-id="ed876-104">The <xref:System.Windows.Forms.DataGridView> control supports this functionality by providing a row for new records, which is always shown as the last row.</span></span> <span data-ttu-id="ed876-105">它在其行标题中用星号标记 ( \* ) 符号。</span><span class="sxs-lookup"><span data-stu-id="ed876-105">It is marked with an asterisk (\*) symbol in its row header.</span></span> <span data-ttu-id="ed876-106">以下各节讨论了在对启用了新记录的行进行编程时应考虑的一些事项。</span><span class="sxs-lookup"><span data-stu-id="ed876-106">The following sections discuss some of the things you should consider when you program with the row for new records enabled.</span></span>  
  
## <a name="displaying-the-row-for-new-records"></a><span data-ttu-id="ed876-107">显示新记录的行</span><span class="sxs-lookup"><span data-stu-id="ed876-107">Displaying the Row for New Records</span></span>  
 <span data-ttu-id="ed876-108">使用 <xref:System.Windows.Forms.DataGridView.AllowUserToAddRows%2A> 属性可指示是否显示新记录的行。</span><span class="sxs-lookup"><span data-stu-id="ed876-108">Use the <xref:System.Windows.Forms.DataGridView.AllowUserToAddRows%2A> property to indicate whether the row for new records is displayed.</span></span> <span data-ttu-id="ed876-109">此属性的默认值为 `true`。</span><span class="sxs-lookup"><span data-stu-id="ed876-109">The default value of this property is `true`.</span></span>  
  
 <span data-ttu-id="ed876-110">对于数据绑定事例，如果 <xref:System.Windows.Forms.DataGridView.AllowUserToAddRows%2A> 控件的属性和 <xref:System.ComponentModel.IBindingList.AllowNew%2A?displayProperty=nameWithType> 数据源的属性均为，则将显示新记录的行 `true` 。</span><span class="sxs-lookup"><span data-stu-id="ed876-110">For the data bound case, the row for new records will be shown if the <xref:System.Windows.Forms.DataGridView.AllowUserToAddRows%2A> property of the control and the <xref:System.ComponentModel.IBindingList.AllowNew%2A?displayProperty=nameWithType> property of the data source are both `true`.</span></span> <span data-ttu-id="ed876-111">否则， `false` 将不会显示该行。</span><span class="sxs-lookup"><span data-stu-id="ed876-111">If either is `false` then the row will not be shown.</span></span>  
  
## <a name="populating-the-row-for-new-records-with-default-data"></a><span data-ttu-id="ed876-112">用默认数据填充新记录行</span><span class="sxs-lookup"><span data-stu-id="ed876-112">Populating the Row for New Records with Default Data</span></span>  
 <span data-ttu-id="ed876-113">当用户将新记录的行选为当前行时， <xref:System.Windows.Forms.DataGridView> 控件引发 <xref:System.Windows.Forms.DataGridView.DefaultValuesNeeded> 事件。</span><span class="sxs-lookup"><span data-stu-id="ed876-113">When the user selects the row for new records as the current row, the <xref:System.Windows.Forms.DataGridView> control raises the <xref:System.Windows.Forms.DataGridView.DefaultValuesNeeded> event.</span></span>  
  
 <span data-ttu-id="ed876-114">此事件提供对新的访问 <xref:System.Windows.Forms.DataGridViewRow> ，使你可以使用默认数据填充新行。</span><span class="sxs-lookup"><span data-stu-id="ed876-114">This event provides access to the new <xref:System.Windows.Forms.DataGridViewRow> and enables you to populate the new row with default data.</span></span> <span data-ttu-id="ed876-115">有关详细信息，请参阅 [如何：在 Windows 窗体 DataGridView 控件中指定新行的默认值](specify-default-values-for-new-rows-in-the-datagrid.md)</span><span class="sxs-lookup"><span data-stu-id="ed876-115">For more information, see [How to: Specify Default Values for New Rows in the Windows Forms DataGridView Control](specify-default-values-for-new-rows-in-the-datagrid.md)</span></span>  
  
## <a name="the-rows-collection"></a><span data-ttu-id="ed876-116">Rows 集合</span><span class="sxs-lookup"><span data-stu-id="ed876-116">The Rows Collection</span></span>  
 <span data-ttu-id="ed876-117">新记录的行包含在 <xref:System.Windows.Forms.DataGridView> 控件的集合中， <xref:System.Windows.Forms.DataGridView.Rows%2A> 但在两个方面具有不同的行为：</span><span class="sxs-lookup"><span data-stu-id="ed876-117">The row for new records is contained in the <xref:System.Windows.Forms.DataGridView> control's <xref:System.Windows.Forms.DataGridView.Rows%2A> collection but behaves differently in two respects:</span></span>  
  
- <span data-ttu-id="ed876-118">不能以编程方式从集合中删除新记录的行 <xref:System.Windows.Forms.DataGridView.Rows%2A> 。</span><span class="sxs-lookup"><span data-stu-id="ed876-118">The row for new records cannot be removed from the <xref:System.Windows.Forms.DataGridView.Rows%2A> collection programmatically.</span></span> <span data-ttu-id="ed876-119"><xref:System.InvalidOperationException>如果尝试这样做，则会引发。</span><span class="sxs-lookup"><span data-stu-id="ed876-119">An <xref:System.InvalidOperationException> is thrown if this is attempted.</span></span> <span data-ttu-id="ed876-120">用户也无法删除新记录所在的行。</span><span class="sxs-lookup"><span data-stu-id="ed876-120">The user also cannot delete the row for new records.</span></span> <span data-ttu-id="ed876-121"><xref:System.Windows.Forms.DataGridViewRowCollection.Clear%2A?displayProperty=nameWithType>方法不会从集合中删除此行 <xref:System.Windows.Forms.DataGridView.Rows%2A> 。</span><span class="sxs-lookup"><span data-stu-id="ed876-121">The <xref:System.Windows.Forms.DataGridViewRowCollection.Clear%2A?displayProperty=nameWithType> method does not remove this row from the <xref:System.Windows.Forms.DataGridView.Rows%2A> collection.</span></span>  
  
- <span data-ttu-id="ed876-122">不能在新记录行后添加行。</span><span class="sxs-lookup"><span data-stu-id="ed876-122">No row can be added after the row for new records.</span></span> <span data-ttu-id="ed876-123"><xref:System.InvalidOperationException>如果尝试这样做，则会引发。</span><span class="sxs-lookup"><span data-stu-id="ed876-123">An <xref:System.InvalidOperationException> is raised if this is attempted.</span></span> <span data-ttu-id="ed876-124">因此，新记录的行始终是控件中的最后一行 <xref:System.Windows.Forms.DataGridView> 。</span><span class="sxs-lookup"><span data-stu-id="ed876-124">As a result, the row for new records is always the last row in the <xref:System.Windows.Forms.DataGridView> control.</span></span> <span data-ttu-id="ed876-125"><xref:System.Windows.Forms.DataGridViewRowCollection>添加行的方法（ <xref:System.Windows.Forms.DataGridViewRowCollection.Add%2A> 、 <xref:System.Windows.Forms.DataGridViewRowCollection.AddCopy%2A> 和 <xref:System.Windows.Forms.DataGridViewRowCollection.AddCopies%2A> ）是在新记录的行出现时在内部调用插入方法的方法。</span><span class="sxs-lookup"><span data-stu-id="ed876-125">The methods on <xref:System.Windows.Forms.DataGridViewRowCollection> that add rows—<xref:System.Windows.Forms.DataGridViewRowCollection.Add%2A>, <xref:System.Windows.Forms.DataGridViewRowCollection.AddCopy%2A>, and <xref:System.Windows.Forms.DataGridViewRowCollection.AddCopies%2A>—all call insertion methods internally when the row for new records is present.</span></span>  
  
## <a name="visual-customization-of-the-row-for-new-records"></a><span data-ttu-id="ed876-126">新记录的行的可视化自定义</span><span class="sxs-lookup"><span data-stu-id="ed876-126">Visual Customization of the Row for New Records</span></span>  
 <span data-ttu-id="ed876-127">当创建新记录行时，将基于属性指定的行 <xref:System.Windows.Forms.DataGridView.RowTemplate%2A> 。</span><span class="sxs-lookup"><span data-stu-id="ed876-127">When the row for new records is created, it is based on the row specified by the <xref:System.Windows.Forms.DataGridView.RowTemplate%2A> property.</span></span> <span data-ttu-id="ed876-128">未为此行指定的任何单元格样式将从其他属性继承。</span><span class="sxs-lookup"><span data-stu-id="ed876-128">Any cell styles that are not specified for this row are inherited from other properties.</span></span> <span data-ttu-id="ed876-129">有关单元样式继承的详细信息，请参阅 [Windows 窗体 DataGridView 控件中的单元格样式](cell-styles-in-the-windows-forms-datagridview-control.md)。</span><span class="sxs-lookup"><span data-stu-id="ed876-129">For more information about cell style inheritance, see [Cell Styles in the Windows Forms DataGridView Control](cell-styles-in-the-windows-forms-datagridview-control.md).</span></span>  
  
 <span data-ttu-id="ed876-130">新记录的行中的单元格显示的初始值从每个单元格的属性中进行检索 <xref:System.Windows.Forms.DataGridViewCell.DefaultNewRowValue%2A> 。</span><span class="sxs-lookup"><span data-stu-id="ed876-130">The initial values displayed by cells in the row for new records are retrieved from each cell's <xref:System.Windows.Forms.DataGridViewCell.DefaultNewRowValue%2A> property.</span></span> <span data-ttu-id="ed876-131">对于类型的单元格 <xref:System.Windows.Forms.DataGridViewImageCell> ，此属性返回占位符图像。</span><span class="sxs-lookup"><span data-stu-id="ed876-131">For cells of type <xref:System.Windows.Forms.DataGridViewImageCell>, this property returns a placeholder image.</span></span> <span data-ttu-id="ed876-132">对于其他类型的单元格，此属性返回 `null`。</span><span class="sxs-lookup"><span data-stu-id="ed876-132">Otherwise, this property returns `null`.</span></span> <span data-ttu-id="ed876-133">您可以重写此属性以返回自定义值。</span><span class="sxs-lookup"><span data-stu-id="ed876-133">You can override this property to return a custom value.</span></span> <span data-ttu-id="ed876-134">但是， <xref:System.Windows.Forms.DataGridView.DefaultValuesNeeded> 当焦点进入新记录行时，这些初始值可以由事件处理程序替换。</span><span class="sxs-lookup"><span data-stu-id="ed876-134">However, these initial values can be replaced by a <xref:System.Windows.Forms.DataGridView.DefaultValuesNeeded> event handler when focus enters the row for new records.</span></span>  
  
 <span data-ttu-id="ed876-135">此行标题的标准图标（箭头或星号）不公开公开。</span><span class="sxs-lookup"><span data-stu-id="ed876-135">The standard icons for this row's header, which are an arrow or an asterisk, are not exposed publicly.</span></span> <span data-ttu-id="ed876-136">如果要自定义图标，将需要创建一个自定义 <xref:System.Windows.Forms.DataGridViewRowHeaderCell> 类。</span><span class="sxs-lookup"><span data-stu-id="ed876-136">If you want to customize the icons, you will need to create a custom <xref:System.Windows.Forms.DataGridViewRowHeaderCell> class.</span></span>  
  
 <span data-ttu-id="ed876-137">标准图标使用 <xref:System.Windows.Forms.DataGridViewCellStyle.ForeColor%2A> <xref:System.Windows.Forms.DataGridViewCellStyle> 由行标题单元格使用的的属性。</span><span class="sxs-lookup"><span data-stu-id="ed876-137">The standard icons use the <xref:System.Windows.Forms.DataGridViewCellStyle.ForeColor%2A> property of the <xref:System.Windows.Forms.DataGridViewCellStyle> in use by the row header cell.</span></span> <span data-ttu-id="ed876-138">如果没有足够的空间来完全显示标准图标，则不会呈现标准图标。</span><span class="sxs-lookup"><span data-stu-id="ed876-138">The standard icons are not rendered if there is not enough space to display them completely.</span></span>  
  
 <span data-ttu-id="ed876-139">如果行标题单元格设置了字符串值，并且文本和图标没有足够的空间，则会先删除该图标。</span><span class="sxs-lookup"><span data-stu-id="ed876-139">If the row header cell has a string value set, and if there is not enough room for both the text and icon, the icon is dropped first.</span></span>  
  
## <a name="sorting"></a><span data-ttu-id="ed876-140">排序</span><span class="sxs-lookup"><span data-stu-id="ed876-140">Sorting</span></span>  
 <span data-ttu-id="ed876-141">在未绑定模式下，即使用户已对的内容进行排序，新记录也将始终添加到的末尾 <xref:System.Windows.Forms.DataGridView> <xref:System.Windows.Forms.DataGridView> 。</span><span class="sxs-lookup"><span data-stu-id="ed876-141">In unbound mode, new records will always be added to the end of the <xref:System.Windows.Forms.DataGridView> even if the user has sorted the content of the <xref:System.Windows.Forms.DataGridView>.</span></span> <span data-ttu-id="ed876-142">用户需要再次应用排序，才能将行排序到正确位置;此行为与控件的行为类似 <xref:System.Windows.Forms.ListView> 。</span><span class="sxs-lookup"><span data-stu-id="ed876-142">The user will need to apply the sort again in order to sort the row to the correct position; this behavior is similar to that of the <xref:System.Windows.Forms.ListView> control.</span></span>  
  
 <span data-ttu-id="ed876-143">在数据绑定和虚拟模式下，应用排序时的插入行为将取决于数据模型的实现。</span><span class="sxs-lookup"><span data-stu-id="ed876-143">In data bound and virtual modes, the insertion behavior when a sort is applied will be dependent on the implementation of the data model.</span></span> <span data-ttu-id="ed876-144">对于 ADO.NET，该行会立即排序到正确的位置。</span><span class="sxs-lookup"><span data-stu-id="ed876-144">For ADO.NET, the row is immediately sorted into the correct position.</span></span>  
  
## <a name="other-notes-on-the-row-for-new-records"></a><span data-ttu-id="ed876-145">新记录所在行的其他备注</span><span class="sxs-lookup"><span data-stu-id="ed876-145">Other Notes on the Row for New Records</span></span>  
 <span data-ttu-id="ed876-146">不能将 <xref:System.Windows.Forms.DataGridViewRow.Visible%2A> 此行的属性设置为 `false` 。</span><span class="sxs-lookup"><span data-stu-id="ed876-146">You cannot set the <xref:System.Windows.Forms.DataGridViewRow.Visible%2A> property of this row to `false`.</span></span> <span data-ttu-id="ed876-147"><xref:System.InvalidOperationException>如果尝试这样做，则会引发。</span><span class="sxs-lookup"><span data-stu-id="ed876-147">An <xref:System.InvalidOperationException> is raised if this is attempted.</span></span>  
  
 <span data-ttu-id="ed876-148">新记录的行始终创建为未选定状态。</span><span class="sxs-lookup"><span data-stu-id="ed876-148">The row for new records is always created in the unselected state.</span></span>  
  
## <a name="virtual-mode"></a><span data-ttu-id="ed876-149">虚拟模式</span><span class="sxs-lookup"><span data-stu-id="ed876-149">Virtual Mode</span></span>  
 <span data-ttu-id="ed876-150">如果要实现虚拟模式，则需要跟踪数据模型中何时需要新记录的行以及何时回滚行的添加。</span><span class="sxs-lookup"><span data-stu-id="ed876-150">If you are implementing virtual mode, you will need to track when a row for new records is needed in the data model and when to roll back the addition of the row.</span></span> <span data-ttu-id="ed876-151">此功能的确切实现取决于数据模型的实现及其事务语义，例如，提交作用域是位于单元级还是行级。</span><span class="sxs-lookup"><span data-stu-id="ed876-151">The exact implementation of this functionality depends on the implementation of the data model and its transaction semantics, for example, whether commit scope is at the cell or row level.</span></span> <span data-ttu-id="ed876-152">有关详细信息，请参阅 [Windows 窗体 DataGridView 控件中的虚拟模式](virtual-mode-in-the-windows-forms-datagridview-control.md)。</span><span class="sxs-lookup"><span data-stu-id="ed876-152">For more information, see [Virtual Mode in the Windows Forms DataGridView Control](virtual-mode-in-the-windows-forms-datagridview-control.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ed876-153">另请参阅</span><span class="sxs-lookup"><span data-stu-id="ed876-153">See also</span></span>

- <xref:System.Windows.Forms.DataGridView>
- <xref:System.Windows.Forms.DataGridView.DefaultValuesNeeded?displayProperty=nameWithType>
- [<span data-ttu-id="ed876-154">Windows 窗体 DataGridView 控件中的数据输入</span><span class="sxs-lookup"><span data-stu-id="ed876-154">Data Entry in the Windows Forms DataGridView Control</span></span>](data-entry-in-the-windows-forms-datagridview-control.md)
- [<span data-ttu-id="ed876-155">如何：为 Windows 窗体 DataGridView 控件中的新行指定默认值</span><span class="sxs-lookup"><span data-stu-id="ed876-155">How to: Specify Default Values for New Rows in the Windows Forms DataGridView Control</span></span>](specify-default-values-for-new-rows-in-the-datagrid.md)
