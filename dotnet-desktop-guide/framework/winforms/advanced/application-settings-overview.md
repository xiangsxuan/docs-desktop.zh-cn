---
title: 应用程序设置概述
description: 了解 Windows 窗体的应用程序设置功能，例如如何代表应用程序和用户创建和存储设置数据。
ms.date: 03/30/2017
ms.topic: overview
f1_keywords:
- ApplicationsSettingsOverview
helpviewer_keywords:
- application settings [Windows Forms], about application settings
- dynamic properties
- user preferences [Windows Forms], tracking
ms.assetid: 0dd8bca5-a6bf-4ac4-8eec-5725d08b38dc
ms.openlocfilehash: fee810f2ed8dece1c804aba0003734470734760f
ms.sourcegitcommit: 9f6df084c53a3da0ea657ed0d708a72213683084
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/09/2020
ms.locfileid: "96970827"
---
# <a name="application-settings-overview"></a><span data-ttu-id="5e31a-103">应用程序设置概述</span><span class="sxs-lookup"><span data-stu-id="5e31a-103">Application Settings Overview</span></span>

<span data-ttu-id="5e31a-104">本文讨论如何代表你的应用程序和用户创建和存储设置数据。</span><span class="sxs-lookup"><span data-stu-id="5e31a-104">This article discusses how to create and store settings data on behalf of your application and your users.</span></span>

 <span data-ttu-id="5e31a-105">Windows 窗体的应用程序设置功能使你可以在客户端计算机上轻松创建、存储和维护自定义应用程序和用户首选项。</span><span class="sxs-lookup"><span data-stu-id="5e31a-105">The Application Settings feature of Windows Forms makes it easy to create, store, and maintain custom application and user preferences on the client computer.</span></span> <span data-ttu-id="5e31a-106">利用 Windows 窗体应用程序设置，不仅可以存储应用程序数据（如数据库连接字符串），还可以存储特定于用户的数据（如用户应用程序首选项）。</span><span class="sxs-lookup"><span data-stu-id="5e31a-106">With Windows Forms application settings, you can store not only application data such as database connection strings, but also user-specific data, such as user application preferences.</span></span> <span data-ttu-id="5e31a-107">使用 Visual Studio 或自定义托管代码，可以创建新设置、从磁盘读取设置和将设置写入磁盘、将设置绑定到窗体上的属性，以及在加载和保存设置数据前对设置数据进行验证。</span><span class="sxs-lookup"><span data-stu-id="5e31a-107">Using Visual Studio or custom managed code, you can create new settings, read them from and write them to disk, bind them to properties on your forms, and validate settings data prior to loading and saving.</span></span>

 <span data-ttu-id="5e31a-108">应用程序设置使开发人员可以使用极少量的自定义代码在他们的应用程序中保存状态，并且替换为以前版本的 .NET Framework 中的动态属性。</span><span class="sxs-lookup"><span data-stu-id="5e31a-108">Application settings enables developers to save state in their application using very little custom code, and is a replacement for dynamic properties in previous versions of the .NET Framework.</span></span> <span data-ttu-id="5e31a-109">应用程序设置在很多方面优于动态属性，动态属性是只读的、后期绑定的，且需要较多的自定义编程。</span><span class="sxs-lookup"><span data-stu-id="5e31a-109">Application settings contains many improvements over dynamic properties, which are read-only, late-bound, and require more custom programming.</span></span> <span data-ttu-id="5e31a-110">动态属性类已保留在 .NET Framework 2.0 中，但它们只是 shell 类，用于对应用程序设置类进行简单包装。</span><span class="sxs-lookup"><span data-stu-id="5e31a-110">The dynamic property classes have been retained in .NET Framework 2.0, but they are just shell classes that thinly wrap the application settings classes.</span></span>

## <a name="what-are-application-settings"></a><span data-ttu-id="5e31a-111">什么是应用程序设置</span><span class="sxs-lookup"><span data-stu-id="5e31a-111">What Are Application Settings</span></span>

 <span data-ttu-id="5e31a-112">您的 Windows 窗体应用程序通常需要数据对运行应用程序至关重要，但您不希望直接在应用程序的代码中包含这些数据。</span><span class="sxs-lookup"><span data-stu-id="5e31a-112">Your Windows Forms applications will often require data that's critical to running the application, but which you don't want to include directly in the application's code.</span></span> <span data-ttu-id="5e31a-113">如果你的应用程序使用 Web 服务或数据库服务器，则你可能希望将此信息存储在单独的文件中，以便将来可以在不重新编译的情况下进行更改。</span><span class="sxs-lookup"><span data-stu-id="5e31a-113">If your application uses a Web Service or a database server, you may want to store this information in a separate file, so that you can change it in the future without recompiling.</span></span> <span data-ttu-id="5e31a-114">同样，应用程序还可能需要存储特定于当前用户的数据。</span><span class="sxs-lookup"><span data-stu-id="5e31a-114">Similarly, your applications may require storing data that is specific to the current user.</span></span> <span data-ttu-id="5e31a-115">例如，大多数应用程序都有用户首选项功能，该功能用于自定义应用程序的外观和行为。</span><span class="sxs-lookup"><span data-stu-id="5e31a-115">Most applications, for example, have user preferences that customize the application's appearance and behavior.</span></span>

 <span data-ttu-id="5e31a-116">应用程序设置通过提供一种简便方法，将应用程序范围设置和用户范围设置存储在客户端计算机上，从而满足了上述这两种需求。</span><span class="sxs-lookup"><span data-stu-id="5e31a-116">Application settings addresses both needs by providing an easy way to store both application-scoped and user-scoped settings on the client computer.</span></span> <span data-ttu-id="5e31a-117">使用 Visual Studio 或代码编辑器，可以通过指定设置的名称、数据类型和范围（应用程序或用户）来定义给定属性的设置。</span><span class="sxs-lookup"><span data-stu-id="5e31a-117">Using Visual Studio or a code editor, you define a setting for a given property by specifying its name, data type, and scope (application or user).</span></span> <span data-ttu-id="5e31a-118">还可以将相关设置放在命名组中以方便使用和读取。</span><span class="sxs-lookup"><span data-stu-id="5e31a-118">You can even place related settings into named groups for easier use and readability.</span></span> <span data-ttu-id="5e31a-119">定义设置后，这些设置将保持不变并在运行时被自动读回到内存中。</span><span class="sxs-lookup"><span data-stu-id="5e31a-119">Once defined, these settings are persisted and read back into memory automatically at run time.</span></span> <span data-ttu-id="5e31a-120">可插入体系结构允许更改保持机制，但默认情况下使用本地文件系统。</span><span class="sxs-lookup"><span data-stu-id="5e31a-120">A pluggable architecture enables the persistence mechanism to be changed, but by default, the local file system is used.</span></span>

 <span data-ttu-id="5e31a-121">应用程序设置的工作方式是：根据设置是应用程序范围设置还是用户范围设置，将数据作为 XML 保持在不同的配置文件 (.config) 中。</span><span class="sxs-lookup"><span data-stu-id="5e31a-121">Application settings works by persisting data as XML to different configuration (.config) files, corresponding to whether the setting is application-scoped or user-scoped.</span></span> <span data-ttu-id="5e31a-122">在大多数情况下，应用程序范围设置是只读的；因为它们是编程信息，通常不需要覆盖它们。</span><span class="sxs-lookup"><span data-stu-id="5e31a-122">In most cases, the application-scoped settings are read-only; because they are program information, you will typically not need to overwrite them.</span></span> <span data-ttu-id="5e31a-123">相反，在运行时可以安全地读写用户范围设置，即使应用程序在部分信任环境下运行也是如此。</span><span class="sxs-lookup"><span data-stu-id="5e31a-123">By contrast, user-scoped settings can be read and written safely at run time, even if your application runs under partial trust.</span></span> <span data-ttu-id="5e31a-124">有关分部信任的详细信息，请参阅 [Security in Windows Forms Overview](../security-in-windows-forms-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="5e31a-124">For more information about partial trust, see [Security in Windows Forms Overview](../security-in-windows-forms-overview.md).</span></span>

 <span data-ttu-id="5e31a-125">设置在配置文件中存储为 XML 片段。</span><span class="sxs-lookup"><span data-stu-id="5e31a-125">Settings are stored as XML fragments in configuration files.</span></span> <span data-ttu-id="5e31a-126">应用程序范围设置由 `<applicationSettings>` 元素表示，这些设置通常位于 *app*.exe.config 中，其中 *app* 是主可执行文件的名称。</span><span class="sxs-lookup"><span data-stu-id="5e31a-126">Application-scoped settings are represented by the `<applicationSettings>` element, and generally are placed in *app*.exe.config, where *app* is the name of your main executable file.</span></span> <span data-ttu-id="5e31a-127">用户范围设置由 `<userSettings>` 元素表示，这些设置位于 *user*.config 中，其中 *user* 是当前运行应用程序的用户的用户名。</span><span class="sxs-lookup"><span data-stu-id="5e31a-127">User-scoped settings are represented by the `<userSettings>` element and are placed in *user*.config, where *user* is the user name of the person currently running the application.</span></span> <span data-ttu-id="5e31a-128">*app*.exe.config 文件必须与应用程序一起部署；当应用程序首次保存用户设置时，设置体系结构将按要求创建 *user*.config 文件。</span><span class="sxs-lookup"><span data-stu-id="5e31a-128">You must deploy the *app*.exe.config file with your application; the settings architecture will create the *user*.config files on demand the first time the application saves settings for that user.</span></span> <span data-ttu-id="5e31a-129">还可在 *app*.exe.config 中定义 `<userSettings>` 块，以便为用户范围设置提供默认值。</span><span class="sxs-lookup"><span data-stu-id="5e31a-129">You can also define a `<userSettings>` block within *app*.exe.config to provide default values for user-scoped settings.</span></span>

 <span data-ttu-id="5e31a-130">自定义控件还可通过实现 <xref:System.Configuration.IPersistComponentSettings> 接口保存它们自己的设置，该接口公开 <xref:System.Configuration.IPersistComponentSettings.SaveSettings%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="5e31a-130">Custom controls can also save their own settings by implementing the <xref:System.Configuration.IPersistComponentSettings> interface, which exposes the <xref:System.Configuration.IPersistComponentSettings.SaveSettings%2A> method.</span></span> <span data-ttu-id="5e31a-131">Windows 窗体 <xref:System.Windows.Forms.ToolStrip> 控件实现此接口，以在应用程序会话之间保存工具栏和工具栏项的位置。</span><span class="sxs-lookup"><span data-stu-id="5e31a-131">The Windows Forms <xref:System.Windows.Forms.ToolStrip> control implements this interface to save the position of toolbars and toolbar items between application sessions.</span></span> <span data-ttu-id="5e31a-132">有关自定义控件和应用程序设置的详细信息，请参阅[自定义控件的应用程序设置](application-settings-for-custom-controls.md)。</span><span class="sxs-lookup"><span data-stu-id="5e31a-132">For more information about custom controls and application settings, see [Application Settings for Custom Controls](application-settings-for-custom-controls.md).</span></span>

## <a name="limitations-of-application-settings"></a><span data-ttu-id="5e31a-133">应用程序设置的限制</span><span class="sxs-lookup"><span data-stu-id="5e31a-133">Limitations of Application Settings</span></span>

 <span data-ttu-id="5e31a-134">不能在承载 .NET Framework 的非托管应用程序中使用应用程序设置。</span><span class="sxs-lookup"><span data-stu-id="5e31a-134">You cannot use application settings in an unmanaged application that hosts the .NET Framework.</span></span> <span data-ttu-id="5e31a-135">这些设置在以下环境中将无效：Visual Studio 外接程序、用于 Microsoft Office 的 C++、托管在 Internet Explorer 中的控件或 Microsoft Outlook 外接程序和项目。</span><span class="sxs-lookup"><span data-stu-id="5e31a-135">Settings will not work in such environments as Visual Studio add-ins, C++ for Microsoft Office, control hosting in Internet Explorer, or Microsoft Outlook add-ins and projects.</span></span>

 <span data-ttu-id="5e31a-136">当前无法绑定到 Windows 窗体中的某些属性。</span><span class="sxs-lookup"><span data-stu-id="5e31a-136">You currently cannot bind to some properties in Windows Forms.</span></span> <span data-ttu-id="5e31a-137">最需要引起注意的是 <xref:System.Windows.Forms.Form.ClientSize%2A> 属性，因为绑定到该属性会导致在运行时发生不可预测的行为。</span><span class="sxs-lookup"><span data-stu-id="5e31a-137">The most notable example is the <xref:System.Windows.Forms.Form.ClientSize%2A> property, as binding to this property would cause unpredictable behavior at run time.</span></span> <span data-ttu-id="5e31a-138">通常可以通过以编程方式保存和加载这些设置来解决这些问题。</span><span class="sxs-lookup"><span data-stu-id="5e31a-138">You can usually work around these issues by saving and loading these settings programmatically.</span></span>

 <span data-ttu-id="5e31a-139">应用程序设置不具备用于自动加密信息的内置功能。</span><span class="sxs-lookup"><span data-stu-id="5e31a-139">Application settings has no built-in facility for encrypting information automatically.</span></span> <span data-ttu-id="5e31a-140">切勿以明文形式存储与安全有关的信息，例如数据库密码。</span><span class="sxs-lookup"><span data-stu-id="5e31a-140">You should never store security-related information, such as database passwords, in clear text.</span></span> <span data-ttu-id="5e31a-141">如果要存储此类敏感信息，你作为应用程序开发人员有责任确保它是安全的。</span><span class="sxs-lookup"><span data-stu-id="5e31a-141">If you want to store such sensitive information, you as the application developer are responsible for making sure it is secure.</span></span> <span data-ttu-id="5e31a-142">如果要存储连接字符串，我们建议你使用 Windows 集成安全性，而不采用将密码硬编码到 URL 中的做法。</span><span class="sxs-lookup"><span data-stu-id="5e31a-142">If you want to store connection strings, we recommend that you use Windows Integrated Security and not resort to hard-coding passwords into the URL.</span></span> <span data-ttu-id="5e31a-143">有关更多信息，请参见 [Code Access Security and ADO.NET](/dotnet/framework/data/adonet/code-access-security)。</span><span class="sxs-lookup"><span data-stu-id="5e31a-143">For more information, see [Code Access Security and ADO.NET](/dotnet/framework/data/adonet/code-access-security).</span></span>

## <a name="getting-started-with-application-settings"></a><span data-ttu-id="5e31a-144">开始使用应用程序设置</span><span class="sxs-lookup"><span data-stu-id="5e31a-144">Getting Started with Application Settings</span></span>

 <span data-ttu-id="5e31a-145">如果使用 Visual Studio，则可以在 Windows 窗体设计器中使用“属性”  窗口中的“(ApplicationSettings)”  属性来定义设置。</span><span class="sxs-lookup"><span data-stu-id="5e31a-145">If you use Visual Studio, you can define settings within the Windows Forms Designer using the **(ApplicationSettings)** property in the **Properties** window.</span></span> <span data-ttu-id="5e31a-146">当你以这种方式定义设置时，Visual Studio 会自动创建一个自定义托管包装器类，该类将每个设置与一个类属性关联。</span><span class="sxs-lookup"><span data-stu-id="5e31a-146">When you define settings this way, Visual Studio automatically creates a custom managed wrapper class that associates each setting with a class property.</span></span> <span data-ttu-id="5e31a-147">Visual Studio 还负责将设置绑定到窗体或控件上的属性，以便在显示控件窗体时自动还原控件设置，并在关闭窗体时自动保存控件设置。</span><span class="sxs-lookup"><span data-stu-id="5e31a-147">Visual Studio also takes care of binding the setting to a property on a form or control so that the control's settings are restored automatically when its form is displayed, and saved automatically when the form is closed.</span></span>

 <span data-ttu-id="5e31a-148">如果要对设置进行更细致的控制，你可以定义自己的自定义应用程序设置包装器类。</span><span class="sxs-lookup"><span data-stu-id="5e31a-148">If you want more detailed control over your settings, you can define your own custom applications settings wrapper class.</span></span> <span data-ttu-id="5e31a-149">此操作的实现步骤如下：从 <xref:System.Configuration.ApplicationSettingsBase>派生一个类，然后添加与每个设置相对应的属性，最后将特殊的特性应用到这些属性。</span><span class="sxs-lookup"><span data-stu-id="5e31a-149">This is accomplished by deriving a class from <xref:System.Configuration.ApplicationSettingsBase>, adding a property that corresponds to each setting, and applying special attributes to these properties.</span></span> <span data-ttu-id="5e31a-150">有关创建包装类的详细信息，请参阅[应用程序设置体系结构](application-settings-architecture.md)。</span><span class="sxs-lookup"><span data-stu-id="5e31a-150">For details about creating wrapper classes, see [Application Settings Architecture](application-settings-architecture.md).</span></span>

 <span data-ttu-id="5e31a-151">还可以使用 <xref:System.Windows.Forms.Binding> 类以编程方式将设置绑定到窗体和控件上的属性。</span><span class="sxs-lookup"><span data-stu-id="5e31a-151">You can also use the <xref:System.Windows.Forms.Binding> class to bind settings programmatically to properties on forms and controls.</span></span>

## <a name="see-also"></a><span data-ttu-id="5e31a-152">另请参阅</span><span class="sxs-lookup"><span data-stu-id="5e31a-152">See also</span></span>

- <xref:System.Configuration.ApplicationSettingsBase>
- <xref:System.Configuration.SettingsProvider>
- <xref:System.Configuration.LocalFileSettingsProvider>
- <xref:System.Configuration.IPersistComponentSettings>
- [<span data-ttu-id="5e31a-153">如何：验证应用程序设置</span><span class="sxs-lookup"><span data-stu-id="5e31a-153">How to: Validate Application Settings</span></span>](how-to-validate-application-settings.md)
- [<span data-ttu-id="5e31a-154">管理应用程序设置 (.NET)</span><span class="sxs-lookup"><span data-stu-id="5e31a-154">Managing Application Settings (.NET)</span></span>](/visualstudio/ide/managing-application-settings-dotnet)
- [<span data-ttu-id="5e31a-155">如何：在运行时读取设置 (C#)</span><span class="sxs-lookup"><span data-stu-id="5e31a-155">How To: Read Settings at Run Time With C#</span></span>](how-to-read-settings-at-run-time-with-csharp.md)
- [<span data-ttu-id="5e31a-156">使用应用程序设置和用户设置</span><span class="sxs-lookup"><span data-stu-id="5e31a-156">Using Application Settings and User Settings</span></span>](using-application-settings-and-user-settings.md)
- [<span data-ttu-id="5e31a-157">应用程序设置体系结构</span><span class="sxs-lookup"><span data-stu-id="5e31a-157">Application Settings Architecture</span></span>](application-settings-architecture.md)
- [<span data-ttu-id="5e31a-158">自定义控件的应用程序设置</span><span class="sxs-lookup"><span data-stu-id="5e31a-158">Application Settings for Custom Controls</span></span>](application-settings-for-custom-controls.md)
