---
title: 用户输入验证
description: 了解可 Windows 窗体用于在应用程序中验证用户输入的几种方法。
ms.date: 03/30/2017
ms.topic: overview
helpviewer_keywords:
- Windows Forms, validating user input
- validation [Windows Forms], Windows Forms user input
- user input [Windows Forms], validating in Windows Forms
- validating user input [Windows Forms], Windows Forms
ms.assetid: 4ec07681-1dee-4bf9-be5e-718f635a33a1
ms.openlocfilehash: bc68c8802c3aeaff8368fc700b577bd6b07e5405
ms.sourcegitcommit: 9f6df084c53a3da0ea657ed0d708a72213683084
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/09/2020
ms.locfileid: "96970516"
---
# <a name="user-input-validation-in-windows-forms"></a><span data-ttu-id="e6b3a-103">Windows 窗体中的用户输入验证</span><span class="sxs-lookup"><span data-stu-id="e6b3a-103">User Input Validation in Windows Forms</span></span>

<span data-ttu-id="e6b3a-104">当用户将数据输入应用程序时，可能需要在应用程序使用数据之前验证数据是否有效。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-104">When users enter data into your application, you may want to verify that the data is valid before your application uses it.</span></span> <span data-ttu-id="e6b3a-105">您可能要求某些文本字段的长度不能为零，字段的格式设置为电话号码或其他类型格式的数据，或者不包含任何可用于破坏数据库安全性的不安全字符的字符串。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-105">You may require that certain text fields not be zero-length, that a field be formatted as a telephone number or other type of well-formed data, or that a string not contain any unsafe characters that could be used to compromise the security of a database.</span></span> <span data-ttu-id="e6b3a-106">Windows 窗体提供多种方式来验证应用程序中的输入。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-106">Windows Forms provides several ways for you to validate input in your application.</span></span>  
  
## <a name="validation-with-the-maskedtextbox-control"></a><span data-ttu-id="e6b3a-107">MaskedTextBox 控件验证</span><span class="sxs-lookup"><span data-stu-id="e6b3a-107">Validation with the MaskedTextBox Control</span></span>  

 <span data-ttu-id="e6b3a-108">如果需要要求用户以定义完善的格式输入数据，如电话号码或部件号，则可以通过使用控件，使用最少的代码来快速完成此过程 <xref:System.Windows.Forms.MaskedTextBox> 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-108">If you need to require users to enter data in a well-defined format, such as a telephone number or a part number, you can accomplish this quickly and with minimal code by using the <xref:System.Windows.Forms.MaskedTextBox> control.</span></span> <span data-ttu-id="e6b3a-109">*掩码* 是由掩码语言中的字符组成的字符串，用于指定可在文本框中的任何给定位置输入的字符。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-109">A *mask* is a string made up of characters from a masking language that specifies which characters can be entered at any given position in the text box.</span></span> <span data-ttu-id="e6b3a-110">控件向用户显示一组提示。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-110">The control displays a set of prompts to the user.</span></span> <span data-ttu-id="e6b3a-111">如果用户键入一个不正确的条目（例如，用户在需要数字时键入字母），则控件将自动拒绝输入。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-111">If the user types an incorrect entry, for example, the user types a letter when a digit is required, the control will automatically reject the input.</span></span>  
  
 <span data-ttu-id="e6b3a-112">使用的掩码语言 <xref:System.Windows.Forms.MaskedTextBox> 非常灵活。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-112">The masking language that is used by <xref:System.Windows.Forms.MaskedTextBox> is very flexible.</span></span> <span data-ttu-id="e6b3a-113">它允许你指定所需的字符、可选字符、文本字符，如连字符和圆括号、货币字符和日期分隔符。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-113">It allows you to specify required characters, optional characters, literal characters, such as hyphens and parentheses, currency characters, and date separators.</span></span> <span data-ttu-id="e6b3a-114">绑定到数据源时，控件也能正常工作。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-114">The control also works well when bound to a data source.</span></span> <span data-ttu-id="e6b3a-115"><xref:System.Windows.Forms.Binding.Format>数据绑定上的事件可用于重新设置传入数据的格式，以符合掩码要求，该 <xref:System.Windows.Forms.Binding.Parse> 事件可用于重新设置传出数据的格式，以符合数据字段的规范。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-115">The <xref:System.Windows.Forms.Binding.Format> event on a data binding can be used to reformat incoming data to comply with the mask, and the <xref:System.Windows.Forms.Binding.Parse> event can be used to reformat outgoing data to comply with the specifications of the data field.</span></span>  
  
 <span data-ttu-id="e6b3a-116">有关详细信息，请参阅 [MaskedTextBox 控件](./controls/maskedtextbox-control-windows-forms.md)。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-116">For more information, see [MaskedTextBox Control](./controls/maskedtextbox-control-windows-forms.md).</span></span>  
  
## <a name="event-driven-validation"></a><span data-ttu-id="e6b3a-117">Event-Driven 验证</span><span class="sxs-lookup"><span data-stu-id="e6b3a-117">Event-Driven Validation</span></span>  

 <span data-ttu-id="e6b3a-118">如果希望完全以编程方式控制验证，或需要执行复杂的验证检查，则应使用大多数 Windows 窗体控件中内置的验证事件。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-118">If you want full programmatic control over validation, or need to perform complex validation checks, you should use the validation events built into most Windows Forms controls.</span></span> <span data-ttu-id="e6b3a-119">接受自由格式用户输入的每个控件都有一个 <xref:System.Windows.Forms.Control.Validating> 事件，每当控件需要数据验证时都会发生此事件。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-119">Each control that accepts free-form user input has a <xref:System.Windows.Forms.Control.Validating> event that will occur whenever the control requires data validation.</span></span> <span data-ttu-id="e6b3a-120">在 <xref:System.Windows.Forms.Control.Validating> 事件处理方法中，可以通过多种方式来验证用户输入。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-120">In the <xref:System.Windows.Forms.Control.Validating> event-handling method, you can validate user input in several ways.</span></span> <span data-ttu-id="e6b3a-121">例如，如果您有一个必须包含邮政编码的文本框，则可以通过以下方式执行验证：</span><span class="sxs-lookup"><span data-stu-id="e6b3a-121">For example, if you have a text box that must contain a postal code, you can perform the validation in the following ways:</span></span>  
  
- <span data-ttu-id="e6b3a-122">如果邮政编码必须属于特定的邮政编码组，则可以对输入执行字符串比较，以验证用户输入的数据。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-122">If the postal code must belong to a specific group of zip codes, you can perform a string comparison on the input to validate the data entered by the user.</span></span> <span data-ttu-id="e6b3a-123">例如，如果邮政编码必须在集 {10001，10002，10003} 中，则可以使用字符串比较来验证数据。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-123">For example, if the postal code must be in the set {10001, 10002, 10003}, then you can use a string comparison to validate the data.</span></span>  
  
- <span data-ttu-id="e6b3a-124">如果邮政编码必须是特定的形式，则可以使用正则表达式来验证用户输入的数据。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-124">If the postal code must be in a specific form you can use regular expressions to validate the data entered by the user.</span></span> <span data-ttu-id="e6b3a-125">例如，若要验证窗体 `#####` 或 `#####-####` ，可以使用正则表达式 `^(\d{5})(-\d{4})?$` 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-125">For example, to validate the form `#####` or `#####-####`, you can use the regular expression `^(\d{5})(-\d{4})?$`.</span></span> <span data-ttu-id="e6b3a-126">若要验证窗体 `A#A #A#` ，可以使用正则表达式 `[A-Z]\d[A-Z] \d[A-Z]\d` 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-126">To validate the form `A#A #A#`, you can use the regular expression `[A-Z]\d[A-Z] \d[A-Z]\d`.</span></span> <span data-ttu-id="e6b3a-127">有关正则表达式的详细信息，请参阅 [.NET Framework 正则表达式](/dotnet/standard/base-types/regular-expressions) 和 [正则表达式示例](/dotnet/standard/base-types/regular-expression-example-scanning-for-hrefs)。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-127">For more information about regular expressions, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expressions) and [Regular Expression Examples](/dotnet/standard/base-types/regular-expression-example-scanning-for-hrefs).</span></span>  
  
- <span data-ttu-id="e6b3a-128">如果邮政编码必须是有效的美国邮政编码，则可以调用 Zip 代码 Web 服务来验证用户输入的数据。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-128">If the postal code must be a valid United States Zip code, you could call a Zip code Web service to validate the data entered by the user.</span></span>  
  
 <span data-ttu-id="e6b3a-129"><xref:System.Windows.Forms.Control.Validating>为事件提供类型的对象 <xref:System.ComponentModel.CancelEventArgs> 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-129">The <xref:System.Windows.Forms.Control.Validating> event is supplied an object of type <xref:System.ComponentModel.CancelEventArgs>.</span></span> <span data-ttu-id="e6b3a-130">如果您确定控件的数据无效，则可以 <xref:System.Windows.Forms.Control.Validating> 通过将该对象的属性设置为来取消该事件 <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> `true` 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-130">If you determine that the control's data is not valid, you can cancel the <xref:System.Windows.Forms.Control.Validating> event by setting this object's <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property to `true`.</span></span> <span data-ttu-id="e6b3a-131">如果未设置 <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> 属性，Windows 窗体将假定该控件的验证成功，并引发 <xref:System.Windows.Forms.Control.Validated> 事件。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-131">If you do not set the <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property, Windows Forms will assume that validation succeeded for that control, and raise the <xref:System.Windows.Forms.Control.Validated> event.</span></span>  
  
 <span data-ttu-id="e6b3a-132">有关验证中的电子邮件地址的代码示例 <xref:System.Windows.Controls.TextBox> ，请参阅 <xref:System.Windows.Forms.Control.Validating> 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-132">For a code example that validates an email address in a <xref:System.Windows.Controls.TextBox>, see <xref:System.Windows.Forms.Control.Validating>.</span></span>  
  
### <a name="data-binding-and-event-driven-validation"></a><span data-ttu-id="e6b3a-133">数据绑定和 Event-Driven 验证</span><span class="sxs-lookup"><span data-stu-id="e6b3a-133">Data Binding and Event-Driven Validation</span></span>  

 <span data-ttu-id="e6b3a-134">将控件绑定到数据源（如数据库表）时，验证非常有用。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-134">Validation is very useful when you have bound your controls to a data source, such as a database table.</span></span> <span data-ttu-id="e6b3a-135">通过使用验证，可以确保控件的数据满足数据源所需的格式，并且不包含任何特殊字符（如引号和可能不安全的反斜杠）。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-135">By using validation, you can make sure that your control's data satisfies the format required by the data source, and that it does not contain any special characters such as quotation marks and back slashes that might be unsafe.</span></span>  
  
 <span data-ttu-id="e6b3a-136">使用数据绑定时，控件中的数据将在事件执行期间与数据源同步 <xref:System.Windows.Forms.Control.Validating> 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-136">When you use data binding, the data in your control is synchronized with the data source during execution of the <xref:System.Windows.Forms.Control.Validating> event.</span></span> <span data-ttu-id="e6b3a-137">如果取消该 <xref:System.Windows.Forms.Control.Validating> 事件，则数据不会与数据源同步。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-137">If you cancel the <xref:System.Windows.Forms.Control.Validating> event, the data will not be synchronized with the data source.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="e6b3a-138">如果你具有在事件发生后发生的自定义验证 <xref:System.Windows.Forms.Control.Validating> ，则它不会影响数据绑定。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-138">If you have custom validation that takes place after the <xref:System.Windows.Forms.Control.Validating> event, it will not affect the data binding.</span></span> <span data-ttu-id="e6b3a-139">例如，如果在事件中有一个 <xref:System.Windows.Forms.Control.Validated> 尝试取消数据绑定的代码，则仍将发生数据绑定。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-139">For example, if you have code in a <xref:System.Windows.Forms.Control.Validated> event that attempts to cancel the data binding, the data binding will still occur.</span></span> <span data-ttu-id="e6b3a-140">在这种情况下，若要在事件中执行验证 <xref:System.Windows.Forms.Control.Validated> ，请将 "**数据源更新模式**" 属性 (中的 " **(数据绑定")** \\ **("高级)** 从 **OnValidation** " 更改为 "**从不**"，并将 *控件* 添加 `.DataBindings["` *\<YOURFIELD>* `"].WriteValue()` 到验证代码。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-140">In this case, to perform validation in the <xref:System.Windows.Forms.Control.Validated> event, change the control's **Data Source Update Mode** property (**under (Databindings)**\\ **(Advanced)**) from **OnValidation** to **Never**, and add *Control*`.DataBindings["`*\<YOURFIELD>*`"].WriteValue()` to your validation code.</span></span>  
  
### <a name="implicit-and-explicit-validation"></a><span data-ttu-id="e6b3a-141">隐式和显式验证</span><span class="sxs-lookup"><span data-stu-id="e6b3a-141">Implicit and Explicit Validation</span></span>  

 <span data-ttu-id="e6b3a-142">那么，何时验证控件的数据？</span><span class="sxs-lookup"><span data-stu-id="e6b3a-142">So when does a control's data get validated?</span></span> <span data-ttu-id="e6b3a-143">这由开发人员来负责。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-143">This is up to you, the developer.</span></span> <span data-ttu-id="e6b3a-144">可以根据应用程序的需要，使用隐式或显式验证。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-144">You can use either implicit or explicit validation, depending on the needs of your application.</span></span>  
  
#### <a name="implicit-validation"></a><span data-ttu-id="e6b3a-145">隐式验证</span><span class="sxs-lookup"><span data-stu-id="e6b3a-145">Implicit Validation</span></span>  

 <span data-ttu-id="e6b3a-146">隐式验证方法会在用户输入数据时对数据进行验证。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-146">The implicit validation approach validates data as the user enters it.</span></span> <span data-ttu-id="e6b3a-147">在控件中输入数据时，可以通过读取键来验证数据，也可以在用户从一个控件中将输入焦点移到下一个控件时更常见地使用。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-147">You can validate the data as the data is entered in a control by reading the keys as they are pressed, or more commonly whenever the user takes the input focus away from one control and moves to the next.</span></span> <span data-ttu-id="e6b3a-148">当你希望用户在工作时立即获得有关数据的反馈时，此方法非常有用。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-148">This approach is useful when you want to give the user immediate feedback about the data as they are working.</span></span>  
  
 <span data-ttu-id="e6b3a-149">如果要对控件使用隐式验证，则必须将控件的 <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> 属性设置为 <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange> 或 <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange> 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-149">If you want to use implicit validation for a control, you must set that control's <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property to <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange> or <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>.</span></span> <span data-ttu-id="e6b3a-150">如果取消该 <xref:System.Windows.Forms.Control.Validating> 事件，则将根据您分配给的值来确定该控件的行为 <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-150">If you cancel the <xref:System.Windows.Forms.Control.Validating> event, the behavior of the control will be determined by what value that you assigned to <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>.</span></span> <span data-ttu-id="e6b3a-151">如果已分配 <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange> ，则取消事件将导致 <xref:System.Windows.Forms.Control.Validated> 事件不会发生。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-151">If you assigned <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>, canceling the event will cause the <xref:System.Windows.Forms.Control.Validated> event not to occur.</span></span> <span data-ttu-id="e6b3a-152">输入焦点将保留在当前控件上，直到用户将数据更改为有效输入。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-152">Input focus will remain on the current control until the user changes the data to a valid input.</span></span> <span data-ttu-id="e6b3a-153">如果分配 <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange> 了，则在 <xref:System.Windows.Forms.Control.Validated> 取消事件时不会发生该事件，但焦点仍将更改为下一个控件。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-153">If you assigned <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>, the <xref:System.Windows.Forms.Control.Validated> event will not occur when you cancel the event, but focus will still change to the next control.</span></span>  
  
 <span data-ttu-id="e6b3a-154">分配 <xref:System.Windows.Forms.AutoValidate.Disable> 给 <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> 属性可防止隐式验证。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-154">Assigning <xref:System.Windows.Forms.AutoValidate.Disable> to the <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property prevents implicit validation altogether.</span></span> <span data-ttu-id="e6b3a-155">若要验证控件，则必须使用显式验证。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-155">To validate your controls, you will have to use explicit validation.</span></span>  
  
#### <a name="explicit-validation"></a><span data-ttu-id="e6b3a-156">显式验证</span><span class="sxs-lookup"><span data-stu-id="e6b3a-156">Explicit Validation</span></span>  

 <span data-ttu-id="e6b3a-157">显式验证方法一次验证数据。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-157">The explicit validation approach validates data at one time.</span></span> <span data-ttu-id="e6b3a-158">您可以验证数据以响应用户操作，例如单击 "保存" 按钮或 "下一步" 链接。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-158">You can validate the data in response to a user action, such as clicking a Save button or a Next link.</span></span> <span data-ttu-id="e6b3a-159">用户操作发生时，可以通过以下方式之一触发显式验证：</span><span class="sxs-lookup"><span data-stu-id="e6b3a-159">When the user action occurs, you can trigger explicit validation in one of the following ways:</span></span>  
  
- <span data-ttu-id="e6b3a-160">调用 <xref:System.Windows.Forms.ContainerControl.Validate%2A> 以验证最后一个控件失去焦点。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-160">Call <xref:System.Windows.Forms.ContainerControl.Validate%2A> to validate the last control to have lost focus.</span></span>  
  
- <span data-ttu-id="e6b3a-161">调用 <xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A> 以验证窗体或容器控件中的所有子控件。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-161">Call <xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A> to validate all child controls in a form or container control.</span></span>  
  
- <span data-ttu-id="e6b3a-162">调用自定义方法以手动验证控件中的数据。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-162">Call a custom method to validate the data in the controls manually.</span></span>  
  
#### <a name="default-implicit-validation-behavior-for-windows-forms-controls"></a><span data-ttu-id="e6b3a-163">Windows 窗体控件的默认隐式验证行为</span><span class="sxs-lookup"><span data-stu-id="e6b3a-163">Default Implicit Validation Behavior for Windows Forms Controls</span></span>  

 <span data-ttu-id="e6b3a-164">不同 Windows 窗体控件的属性具有不同的默认值 <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-164">Different Windows Forms controls have different defaults for their <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property.</span></span> <span data-ttu-id="e6b3a-165">下表显示了最常见的控件及其默认值。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-165">The following table shows the most common controls and their defaults.</span></span>  
  
|<span data-ttu-id="e6b3a-166">控制</span><span class="sxs-lookup"><span data-stu-id="e6b3a-166">Control</span></span>|<span data-ttu-id="e6b3a-167">默认验证行为</span><span class="sxs-lookup"><span data-stu-id="e6b3a-167">Default Validation Behavior</span></span>|  
|-------------|---------------------------------|  
|<xref:System.Windows.Forms.ContainerControl>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.Form>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
|<xref:System.Windows.Forms.PropertyGrid>|<span data-ttu-id="e6b3a-168">Visual Studio 中未公开的属性</span><span class="sxs-lookup"><span data-stu-id="e6b3a-168">Property not exposed in Visual Studio</span></span>|  
|<xref:System.Windows.Forms.ToolStripContainer>|<span data-ttu-id="e6b3a-169">Visual Studio 中未公开的属性</span><span class="sxs-lookup"><span data-stu-id="e6b3a-169">Property not exposed in Visual Studio</span></span>|  
|<xref:System.Windows.Forms.SplitContainer>|<xref:System.Windows.Forms.AutoValidate.Inherit>|  
|<xref:System.Windows.Forms.UserControl>|<xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>|  
  
## <a name="closing-the-form-and-overriding-validation"></a><span data-ttu-id="e6b3a-170">关闭窗体并重写验证</span><span class="sxs-lookup"><span data-stu-id="e6b3a-170">Closing the Form and Overriding Validation</span></span>  

 <span data-ttu-id="e6b3a-171">当控件由于其包含的数据无效而维持焦点时，无法通过通常的方式之一关闭父窗体：</span><span class="sxs-lookup"><span data-stu-id="e6b3a-171">When a control maintains focus because the data it contains is invalid, it is impossible to close the parent form in one of the usual ways:</span></span>  
  
- <span data-ttu-id="e6b3a-172">单击 " **关闭** " 按钮。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-172">By clicking the **Close** button.</span></span>  
  
- <span data-ttu-id="e6b3a-173">选择 "**系统**" 菜单中的 "**关闭**"。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-173">By selecting **Close** in the **System** menu.</span></span>  
  
- <span data-ttu-id="e6b3a-174">通过 <xref:System.Windows.Forms.Form.Close%2A> 以编程方式调用方法。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-174">By calling the <xref:System.Windows.Forms.Form.Close%2A> method programmatically.</span></span>  
  
 <span data-ttu-id="e6b3a-175">但是，在某些情况下，您可能需要让用户关闭窗体，无论控件中的值是否有效。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-175">However, in some cases, you might want to let the user close the form regardless of whether the values in the controls are valid.</span></span> <span data-ttu-id="e6b3a-176">您可以通过为窗体的事件创建处理程序来覆盖验证并关闭仍包含无效数据的窗体 <xref:System.Windows.Forms.Form.FormClosing> 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-176">You can override validation and close a form that still contains invalid data by creating a handler for the form's <xref:System.Windows.Forms.Form.FormClosing> event.</span></span> <span data-ttu-id="e6b3a-177">在此事件中，将 <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> 属性设置为 `false` 。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-177">In the event, set the <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property to `false`.</span></span> <span data-ttu-id="e6b3a-178">这会强制关闭窗体。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-178">This forces the form to close.</span></span> <span data-ttu-id="e6b3a-179">有关详细信息及示例，请参阅<xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-179">For more information and an example, see <xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="e6b3a-180">如果以这种方式强制关闭窗体，则尚未保存窗体控件中的所有数据都将丢失。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-180">If you force the form to close in this manner, any data in the form's controls that has not already been saved is lost.</span></span> <span data-ttu-id="e6b3a-181">此外，模式窗体在关闭时不会验证控件的内容。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-181">In addition, modal forms do not validate the contents of controls when they are closed.</span></span> <span data-ttu-id="e6b3a-182">你仍可以使用控件验证将焦点锁定到控件，但你不必担心与关闭窗体相关联的行为。</span><span class="sxs-lookup"><span data-stu-id="e6b3a-182">You can still use control validation to lock focus to a control, but you do not have to be concerned about the behavior associated with closing the form.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e6b3a-183">另请参阅</span><span class="sxs-lookup"><span data-stu-id="e6b3a-183">See also</span></span>

- <xref:System.Windows.Forms.Control.Validating?displayProperty=nameWithType>
- <xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>
- <xref:System.Windows.Forms.FormClosingEventArgs?displayProperty=nameWithType>
- [<span data-ttu-id="e6b3a-184">MaskedTextBox 控件</span><span class="sxs-lookup"><span data-stu-id="e6b3a-184">MaskedTextBox Control</span></span>](./controls/maskedtextbox-control-windows-forms.md)
- [<span data-ttu-id="e6b3a-185">正则表达式示例</span><span class="sxs-lookup"><span data-stu-id="e6b3a-185">Regular Expression Examples</span></span>](/dotnet/standard/base-types/regular-expression-example-scanning-for-hrefs)
