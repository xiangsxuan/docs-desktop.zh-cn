---
title: 计时事件概述
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- timelines [WPF]
- timing events [WPF]
ms.assetid: 597e3280-0867-4359-a97b-5b2f4149e350
ms.openlocfilehash: 040fc5697bc52ee3d6acb4bd425f63c3e5781cbf
ms.sourcegitcommit: 069786bcadbf9cd931d7dc3d892262cd852d2ffb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/19/2021
ms.locfileid: "104667455"
---
# <a name="timing-events-overview"></a><span data-ttu-id="bafe1-102">计时事件概述</span><span class="sxs-lookup"><span data-stu-id="bafe1-102">Timing Events Overview</span></span>
<span data-ttu-id="bafe1-103">本主题介绍如何使用和对象上可用的五个计时事件 <xref:System.Windows.Media.Animation.Timeline> <xref:System.Windows.Media.Animation.Clock> 。</span><span class="sxs-lookup"><span data-stu-id="bafe1-103">This topic describes how to use the five timing events available on <xref:System.Windows.Media.Animation.Timeline> and <xref:System.Windows.Media.Animation.Clock> objects.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="bafe1-104">必备条件</span><span class="sxs-lookup"><span data-stu-id="bafe1-104">Prerequisites</span></span>  
 <span data-ttu-id="bafe1-105">若要了解本主题，应了解如何创建和使用动画。</span><span class="sxs-lookup"><span data-stu-id="bafe1-105">To understand this topic, you should understand how to create and use animations.</span></span> <span data-ttu-id="bafe1-106">若要开始处理动画，请参阅 [动画概述](animation-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="bafe1-106">To get started with animation, see the [Animation Overview](animation-overview.md).</span></span>  
  
 <span data-ttu-id="bafe1-107">可以通过多种方式在中对属性进行动画处理 [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] ：</span><span class="sxs-lookup"><span data-stu-id="bafe1-107">There are multiple ways to animate properties in [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)]:</span></span>  
  
- <span data-ttu-id="bafe1-108">**使用情节提要对象** (标记和代码) ：可以使用 <xref:System.Windows.Media.Animation.Storyboard> 对象排列动画并将其分配给一个或多个对象。</span><span class="sxs-lookup"><span data-stu-id="bafe1-108">**Using storyboard objects** (markup and code): You can use <xref:System.Windows.Media.Animation.Storyboard> objects to arrange and distribute animations to one or more objects.</span></span> <span data-ttu-id="bafe1-109">有关示例，请参阅 [使用情节提要对属性进行动画处理](how-to-animate-a-property-by-using-a-storyboard.md)。</span><span class="sxs-lookup"><span data-stu-id="bafe1-109">For an example, see [Animate a Property by Using a Storyboard](how-to-animate-a-property-by-using-a-storyboard.md).</span></span>  
  
- <span data-ttu-id="bafe1-110">**使用本地动画** (仅) 代码：可以直接将 <xref:System.Windows.Media.Animation.AnimationTimeline> 对象应用于它们动画处理的属性。</span><span class="sxs-lookup"><span data-stu-id="bafe1-110">**Using local animations** (code only): You can apply <xref:System.Windows.Media.Animation.AnimationTimeline> objects directly to the properties they animate.</span></span> <span data-ttu-id="bafe1-111">有关示例，请参阅[在不使用情节提要的情况下对属性进行动画处理](how-to-animate-a-property-without-using-a-storyboard.md)。</span><span class="sxs-lookup"><span data-stu-id="bafe1-111">For an example, see [Animate a Property Without Using a Storyboard](how-to-animate-a-property-without-using-a-storyboard.md).</span></span>  
  
- <span data-ttu-id="bafe1-112">**使用时钟**（仅代码）：可以显式管理时钟创建并自行分发动画时钟。</span><span class="sxs-lookup"><span data-stu-id="bafe1-112">**Using clocks** (code only): You can explicitly manage clock creation and distribute the animation clocks yourself.</span></span>  <span data-ttu-id="bafe1-113">有关示例，请参阅 [使用 system.windows.media.animation.animationclock> 对属性进行动画处理](how-to-animate-a-property-by-using-an-animationclock.md)。</span><span class="sxs-lookup"><span data-stu-id="bafe1-113">For an example, see [Animate a Property by Using an AnimationClock](how-to-animate-a-property-by-using-an-animationclock.md).</span></span>  
  
 <span data-ttu-id="bafe1-114">因为你可以在标记和代码中使用它们，所以本概述中的示例使用 <xref:System.Windows.Media.Animation.Storyboard> 对象。</span><span class="sxs-lookup"><span data-stu-id="bafe1-114">Because you can use them in markup and code, the examples in this overview use <xref:System.Windows.Media.Animation.Storyboard> objects.</span></span> <span data-ttu-id="bafe1-115">但是，所介绍的概念适用于其他对属性进行动画处理的方法。</span><span class="sxs-lookup"><span data-stu-id="bafe1-115">However, the concepts described can be applied to the other methods of animating properties.</span></span>  
  
### <a name="what-is-a-clock"></a><span data-ttu-id="bafe1-116">是什么时钟？</span><span class="sxs-lookup"><span data-stu-id="bafe1-116">What is a clock?</span></span>  
 <span data-ttu-id="bafe1-117">除了描述时间段外，时间线本身并无其他任何作用。</span><span class="sxs-lookup"><span data-stu-id="bafe1-117">A timeline, by itself, doesn't actually do anything other than describe a segment of time.</span></span> <span data-ttu-id="bafe1-118">它是 <xref:System.Windows.Media.Animation.Clock> 执行实际工作的时间线对象：它为时间线维护与计时相关的运行时状态。</span><span class="sxs-lookup"><span data-stu-id="bafe1-118">It's the timeline's <xref:System.Windows.Media.Animation.Clock> object that does the real work: it maintains timing-related run-time state for the timeline.</span></span> <span data-ttu-id="bafe1-119">在大多数情况下，比如使用情节提要时，会自动为时间线创建时钟。</span><span class="sxs-lookup"><span data-stu-id="bafe1-119">In most cases, such as when using storyboards, a clock is created automatically for your timeline.</span></span> <span data-ttu-id="bafe1-120">你还可以 <xref:System.Windows.Media.Animation.Clock> 使用方法显式创建 <xref:System.Windows.Media.Animation.Timeline.CreateClock%2A> 。</span><span class="sxs-lookup"><span data-stu-id="bafe1-120">You can also create a <xref:System.Windows.Media.Animation.Clock> explicitly by using the <xref:System.Windows.Media.Animation.Timeline.CreateClock%2A> method.</span></span> <span data-ttu-id="bafe1-121">有关对象的详细信息 <xref:System.Windows.Media.Animation.Clock> ，请参阅 [动画和计时系统概述](animation-and-timing-system-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="bafe1-121">For more information about <xref:System.Windows.Media.Animation.Clock> objects, see the [Animation and Timing System Overview](animation-and-timing-system-overview.md).</span></span>  
  
## <a name="why-use-events"></a><span data-ttu-id="bafe1-122">为什么使用事件？</span><span class="sxs-lookup"><span data-stu-id="bafe1-122">Why Use Events?</span></span>  
 <span data-ttu-id="bafe1-123">除了一个例外（对齐到上一时钟周期的查找操作），所有交互式计时操作均为异步操作。</span><span class="sxs-lookup"><span data-stu-id="bafe1-123">With the exception of one (seek aligned to last tick), all interactive timing operations are asynchronous.</span></span> <span data-ttu-id="bafe1-124">无法准确知道它们何时执行。</span><span class="sxs-lookup"><span data-stu-id="bafe1-124">There is no way for you to know exactly when they will execute.</span></span> <span data-ttu-id="bafe1-125">当存在其他代码依赖于计时操作时，可能会产生问题。</span><span class="sxs-lookup"><span data-stu-id="bafe1-125">That can be a problem when you have other code that's dependent upon your timing operation.</span></span> <span data-ttu-id="bafe1-126">假设你希望停止对矩形进行动画处理的时间线。</span><span class="sxs-lookup"><span data-stu-id="bafe1-126">Suppose that you wanted to stop a timeline that animated a rectangle.</span></span> <span data-ttu-id="bafe1-127">在时间线停止后，更改矩形的颜色。</span><span class="sxs-lookup"><span data-stu-id="bafe1-127">After the timeline stops, you change the color of the rectangle.</span></span>  
  
 [!code-csharp[events_procedural#NeedForEventsFragment](~/samples/snippets/csharp/VS_Snippets_Wpf/events_procedural/CSharp/EventExample.cs#needforeventsfragment)]
 [!code-vb[events_procedural#NeedForEventsFragment](~/samples/snippets/visualbasic/VS_Snippets_Wpf/events_procedural/VisualBasic/EventExample.vb#needforeventsfragment)]  
  
 <span data-ttu-id="bafe1-128">在上一示例中，第二行代码可能会在情节提要停止前执行。</span><span class="sxs-lookup"><span data-stu-id="bafe1-128">In the previous example, the second line of code might execute before the storyboard stops.</span></span> <span data-ttu-id="bafe1-129">这是因为停止操作是异步操作。</span><span class="sxs-lookup"><span data-stu-id="bafe1-129">That's because stopping is an asynchronous operation.</span></span> <span data-ttu-id="bafe1-130">告知时间线或时钟停止将创建各种“停止请求”，但它仅在计时引擎的下一时钟周期才会处理。</span><span class="sxs-lookup"><span data-stu-id="bafe1-130">Telling a timeline or clock to stop creates a "stop request" of sorts that isn't processed until the timing engine's next tick.</span></span>  
  
 <span data-ttu-id="bafe1-131">若要在时间线完成后执行命令，请使用计时事件。</span><span class="sxs-lookup"><span data-stu-id="bafe1-131">To execute commands after a timeline completes, use timing events.</span></span> <span data-ttu-id="bafe1-132">在下面的示例中，事件处理程序用于在情节提要停止播放后更改矩形的颜色。</span><span class="sxs-lookup"><span data-stu-id="bafe1-132">In the following example, an event handler is used to change the color of a rectangle after the storyboard stops playing.</span></span>  
  
 [!code-csharp[events_procedural#RegisterForStoryboardCurrentStateInvalidatedEvent](~/samples/snippets/csharp/VS_Snippets_Wpf/events_procedural/CSharp/EventExample.cs#registerforstoryboardcurrentstateinvalidatedevent)]
 [!code-vb[events_procedural#RegisterForStoryboardCurrentStateInvalidatedEvent](~/samples/snippets/visualbasic/VS_Snippets_Wpf/events_procedural/VisualBasic/EventExample.vb#registerforstoryboardcurrentstateinvalidatedevent)]  
[!code-csharp[events_procedural#StoryboardCurrentStateInvalidatedEvent2](~/samples/snippets/csharp/VS_Snippets_Wpf/events_procedural/CSharp/EventExample.cs#storyboardcurrentstateinvalidatedevent2)]
[!code-vb[events_procedural#StoryboardCurrentStateInvalidatedEvent2](~/samples/snippets/visualbasic/VS_Snippets_Wpf/events_procedural/VisualBasic/EventExample.vb#storyboardcurrentstateinvalidatedevent2)]  
  
 <span data-ttu-id="bafe1-133">有关更完整的示例，请参阅 [在时钟状态发生更改时接收通知](how-to-receive-notification-when-clock-state-changes.md)。</span><span class="sxs-lookup"><span data-stu-id="bafe1-133">For a more complete example, see [Receive Notification When a Clock's State Changes](how-to-receive-notification-when-clock-state-changes.md).</span></span>  
  
## <a name="public-events"></a><span data-ttu-id="bafe1-134">公共事件</span><span class="sxs-lookup"><span data-stu-id="bafe1-134">Public Events</span></span>  
 <span data-ttu-id="bafe1-135"><xref:System.Windows.Media.Animation.Timeline>和 <xref:System.Windows.Media.Animation.Clock> 类都提供了五个计时事件。</span><span class="sxs-lookup"><span data-stu-id="bafe1-135">The <xref:System.Windows.Media.Animation.Timeline> and <xref:System.Windows.Media.Animation.Clock> classes both provide five timing events.</span></span> <span data-ttu-id="bafe1-136">下表列出了这些事件及其触发条件。</span><span class="sxs-lookup"><span data-stu-id="bafe1-136">The following table lists these events and the conditions that trigger them.</span></span>  
  
|<span data-ttu-id="bafe1-137">事件</span><span class="sxs-lookup"><span data-stu-id="bafe1-137">Event</span></span>|<span data-ttu-id="bafe1-138">触发交互式操作</span><span class="sxs-lookup"><span data-stu-id="bafe1-138">Triggering interactive operation</span></span>|<span data-ttu-id="bafe1-139">其他触发器</span><span class="sxs-lookup"><span data-stu-id="bafe1-139">Other triggers</span></span>|  
|-----------|--------------------------------------|--------------------|  
|<span data-ttu-id="bafe1-140">**已完成**</span><span class="sxs-lookup"><span data-stu-id="bafe1-140">**Completed**</span></span>|<span data-ttu-id="bafe1-141">跳过以填充</span><span class="sxs-lookup"><span data-stu-id="bafe1-141">Skip to fill</span></span>|<span data-ttu-id="bafe1-142">时钟完成。</span><span class="sxs-lookup"><span data-stu-id="bafe1-142">The clock completes.</span></span>|  
|<span data-ttu-id="bafe1-143">**CurrentGlobalSpeedInvalidated**</span><span class="sxs-lookup"><span data-stu-id="bafe1-143">**CurrentGlobalSpeedInvalidated**</span></span>|<span data-ttu-id="bafe1-144">暂停、恢复、查找、设置速度比、跳过以填充、停止</span><span class="sxs-lookup"><span data-stu-id="bafe1-144">Pause, resume, seek, set speed ratio, skip to fill, stop</span></span>|<span data-ttu-id="bafe1-145">时钟反转、加速、启动或停止。</span><span class="sxs-lookup"><span data-stu-id="bafe1-145">The clock reverses, accelerates, starts, or stops.</span></span>|  
|<span data-ttu-id="bafe1-146">**CurrentStateInvalidated**</span><span class="sxs-lookup"><span data-stu-id="bafe1-146">**CurrentStateInvalidated**</span></span>|<span data-ttu-id="bafe1-147">开始、跳过以填充、停止</span><span class="sxs-lookup"><span data-stu-id="bafe1-147">Begin, skip to fill, stop</span></span>|<span data-ttu-id="bafe1-148">时钟开始、停止或填充。</span><span class="sxs-lookup"><span data-stu-id="bafe1-148">The clock starts, stops, or fills.</span></span>|  
|<span data-ttu-id="bafe1-149">**CurrentTimeInvalidated**</span><span class="sxs-lookup"><span data-stu-id="bafe1-149">**CurrentTimeInvalidated**</span></span>|<span data-ttu-id="bafe1-150">开始、查找、跳过以填充、停止</span><span class="sxs-lookup"><span data-stu-id="bafe1-150">Begin, seek, skip to fill, stop</span></span>|<span data-ttu-id="bafe1-151">时钟前进。</span><span class="sxs-lookup"><span data-stu-id="bafe1-151">The clock progresses.</span></span>|  
|<span data-ttu-id="bafe1-152">**RemoveRequested**</span><span class="sxs-lookup"><span data-stu-id="bafe1-152">**RemoveRequested**</span></span>|<span data-ttu-id="bafe1-153">删除</span><span class="sxs-lookup"><span data-stu-id="bafe1-153">Remove</span></span>||  
  
## <a name="ticking-and-event-consolidation"></a><span data-ttu-id="bafe1-154">时钟周期和事件合并</span><span class="sxs-lookup"><span data-stu-id="bafe1-154">Ticking and Event Consolidation</span></span>  
 <span data-ttu-id="bafe1-155">对中的对象进行动画处理时 [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] ，它是用于管理动画的计时引擎。</span><span class="sxs-lookup"><span data-stu-id="bafe1-155">When you animate objects in [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)], it’s the timing engine that manages your animations.</span></span> <span data-ttu-id="bafe1-156">计时引擎跟踪时间进度，并计算每个动画的状态。</span><span class="sxs-lookup"><span data-stu-id="bafe1-156">The timing engine tracks the progression of time and computes the state of each animation.</span></span> <span data-ttu-id="bafe1-157">它一秒内进行多次计算。</span><span class="sxs-lookup"><span data-stu-id="bafe1-157">It makes many such evaluation passes in a second.</span></span> <span data-ttu-id="bafe1-158">这些计算过程称为“时钟周期”。</span><span class="sxs-lookup"><span data-stu-id="bafe1-158">These evaluation passes are known as "ticks."</span></span>  
  
 <span data-ttu-id="bafe1-159">尽管滴答频率很高，但是在两次滴答之间还是有可能会发生许多事情。</span><span class="sxs-lookup"><span data-stu-id="bafe1-159">While ticks occur frequently, it's possible for a lot of things to happen between ticks.</span></span> <span data-ttu-id="bafe1-160">例如，时间线可能会停止、启动、再次停止，在这种情况下其当前状态将更改三次。</span><span class="sxs-lookup"><span data-stu-id="bafe1-160">For example, a timeline might be stopped, started, and stopped again, in which case its current state will have changed three times.</span></span> <span data-ttu-id="bafe1-161">从理论上讲，在一个时钟周期内，可以多次引发事件；但是，计时引擎会合并事件，因此每个事件在每个时钟周期内只能引发一次。</span><span class="sxs-lookup"><span data-stu-id="bafe1-161">In theory, the event could be raised multiple times in a single tick; however, the timing engine consolidates events, so that each event can be raised at most once per tick.</span></span>  
  
## <a name="registering-for-events"></a><span data-ttu-id="bafe1-162">注册事件</span><span class="sxs-lookup"><span data-stu-id="bafe1-162">Registering for Events</span></span>  
 <span data-ttu-id="bafe1-163">可以通过两种方法注册计时事件：使用时间线或使用从时间线创建的时钟进行注册。</span><span class="sxs-lookup"><span data-stu-id="bafe1-163">There are two ways to register for timing events: you can register with the timeline or with the clock created from the timeline.</span></span> <span data-ttu-id="bafe1-164">直接使用时钟注册事件相当简单，不过该方法只能在代码中执行。</span><span class="sxs-lookup"><span data-stu-id="bafe1-164">Registering for an event directly with a clock is fairly straightforward, although it can only be done from code.</span></span> <span data-ttu-id="bafe1-165">可以在标记或代码中使用时间线注册事件。</span><span class="sxs-lookup"><span data-stu-id="bafe1-165">You can register for events with a timeline from markup or code.</span></span> <span data-ttu-id="bafe1-166">下一节介绍如何使用时间线注册时钟事件。</span><span class="sxs-lookup"><span data-stu-id="bafe1-166">The next section describes how to register for clock events with a timeline.</span></span>  
  
<a name="registeringforclockeventswithatimeline"></a>
## <a name="registering-for-clock-events-with-a-timeline"></a><span data-ttu-id="bafe1-167">使用时间线注册时钟事件</span><span class="sxs-lookup"><span data-stu-id="bafe1-167">Registering for Clock Events with a Timeline</span></span>  
 <span data-ttu-id="bafe1-168">尽管时间线的 <xref:System.Windows.Media.Animation.Timeline.Completed> 、 <xref:System.Windows.Media.Animation.Timeline.CurrentGlobalSpeedInvalidated> 、 <xref:System.Windows.Media.Animation.Timeline.CurrentStateInvalidated> 、 <xref:System.Windows.Media.Animation.Timeline.CurrentTimeInvalidated> 和 <xref:System.Windows.Media.Animation.Timeline.RemoveRequested> 事件似乎与时间线相关联，但注册这些事件实际上会将事件处理程序与 <xref:System.Windows.Media.Animation.Clock> 为时间线创建的进行关联。</span><span class="sxs-lookup"><span data-stu-id="bafe1-168">Although a timeline's <xref:System.Windows.Media.Animation.Timeline.Completed>, <xref:System.Windows.Media.Animation.Timeline.CurrentGlobalSpeedInvalidated>, <xref:System.Windows.Media.Animation.Timeline.CurrentStateInvalidated>, <xref:System.Windows.Media.Animation.Timeline.CurrentTimeInvalidated>, and <xref:System.Windows.Media.Animation.Timeline.RemoveRequested> events appear to be associated with the timeline, registering for these events actually associates an event handler with the <xref:System.Windows.Media.Animation.Clock> created for the timeline.</span></span>  
  
 <span data-ttu-id="bafe1-169"><xref:System.Windows.Media.Animation.Timeline.Completed>例如，在时间线上注册事件时，实际上是告诉系统注册为 <xref:System.Windows.Media.Animation.Clock.Completed> 时间线创建的每个时钟的事件。</span><span class="sxs-lookup"><span data-stu-id="bafe1-169">When you register for the <xref:System.Windows.Media.Animation.Timeline.Completed> event on a timeline, for example, you're actually telling the system to register for the <xref:System.Windows.Media.Animation.Clock.Completed> event of each clock that is created for the timeline.</span></span> <span data-ttu-id="bafe1-170">在代码中，你必须在为 <xref:System.Windows.Media.Animation.Clock> 此时间线创建之前注册此事件; 否则，你将不会收到通知。</span><span class="sxs-lookup"><span data-stu-id="bafe1-170">In code, you must register for this event before the <xref:System.Windows.Media.Animation.Clock> is created for this timeline; otherwise, you won't receive notification.</span></span> <span data-ttu-id="bafe1-171">这会在中自动发生 [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] ; 在创建之前，分析器会自动注册事件 <xref:System.Windows.Media.Animation.Clock> 。</span><span class="sxs-lookup"><span data-stu-id="bafe1-171">This happens automatically in [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)]; the parser automatically registers for the event before the <xref:System.Windows.Media.Animation.Clock> is created.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="bafe1-172">请参阅</span><span class="sxs-lookup"><span data-stu-id="bafe1-172">See also</span></span>

- [<span data-ttu-id="bafe1-173">动画和计时系统概述</span><span class="sxs-lookup"><span data-stu-id="bafe1-173">Animation and Timing System Overview</span></span>](animation-and-timing-system-overview.md)
- [<span data-ttu-id="bafe1-174">动画概述</span><span class="sxs-lookup"><span data-stu-id="bafe1-174">Animation Overview</span></span>](animation-overview.md)
- [<span data-ttu-id="bafe1-175">计时行为概述</span><span class="sxs-lookup"><span data-stu-id="bafe1-175">Timing Behaviors Overview</span></span>](timing-behaviors-overview.md)
