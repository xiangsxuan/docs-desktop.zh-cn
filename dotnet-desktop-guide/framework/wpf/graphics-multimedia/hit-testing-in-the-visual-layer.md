---
title: 可视化层中的命中测试
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- hit testing functionality [WPF]
- visual layer [WPF], hit testing functionality
ms.assetid: b1a64b61-14be-4d75-b89a-5c67bebb2c7b
ms.openlocfilehash: 0d3aa75c2fafe9c45365716d3424e051f1e0cf89
ms.sourcegitcommit: bf5dd80f4d7b202afa90e90d1148402c5474d826
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/30/2021
ms.locfileid: "96973129"
---
# <a name="hit-testing-in-the-visual-layer"></a><span data-ttu-id="31a63-102">可视化层中的命中测试</span><span class="sxs-lookup"><span data-stu-id="31a63-102">Hit Testing in the Visual Layer</span></span>
<span data-ttu-id="31a63-103">本主题概述可视化层提供的命中测试功能。</span><span class="sxs-lookup"><span data-stu-id="31a63-103">This topic provides an overview of hit testing functionality provided by the visual layer.</span></span> <span data-ttu-id="31a63-104">利用命中测试支持，您可以确定几何或点值是否在呈现的内容中 <xref:System.Windows.Media.Visual> ，从而可以实现用户界面行为（如选择矩形）来选择多个对象。</span><span class="sxs-lookup"><span data-stu-id="31a63-104">Hit testing support allows you to determine whether a geometry or point value falls within the rendered content of a <xref:System.Windows.Media.Visual>, allowing you to implement user interface behavior such as a selection rectangle to select multiple objects.</span></span>  

<a name="hit_testing_scenarios"></a>
## <a name="hit-testing-scenarios"></a><span data-ttu-id="31a63-105">命中测试方案</span><span class="sxs-lookup"><span data-stu-id="31a63-105">Hit Testing Scenarios</span></span>  
 <span data-ttu-id="31a63-106"><xref:System.Windows.UIElement>类提供 <xref:System.Windows.UIElement.InputHitTest%2A> 方法，该方法允许使用给定的坐标值对元素进行命中测试。</span><span class="sxs-lookup"><span data-stu-id="31a63-106">The <xref:System.Windows.UIElement> class provides the <xref:System.Windows.UIElement.InputHitTest%2A> method, which allows you to hit test against an element using a given coordinate value.</span></span> <span data-ttu-id="31a63-107">在许多情况下， <xref:System.Windows.UIElement.InputHitTest%2A> 方法提供了用于实现元素的命中测试的所需功能。</span><span class="sxs-lookup"><span data-stu-id="31a63-107">In many cases, the <xref:System.Windows.UIElement.InputHitTest%2A> method provides the desired functionality for implementing hit testing of elements.</span></span> <span data-ttu-id="31a63-108">但是，有多种方案可能需要在可视化层上实现命中测试。</span><span class="sxs-lookup"><span data-stu-id="31a63-108">However, there are several scenarios in which you may need to implement hit testing at the visual layer.</span></span>  
  
- <span data-ttu-id="31a63-109">针对非 <xref:System.Windows.UIElement> 对象进行命中测试：这适用于对非 <xref:System.Windows.UIElement> 对象（例如或图形对象）进行命中测试 <xref:System.Windows.Media.DrawingVisual> 。</span><span class="sxs-lookup"><span data-stu-id="31a63-109">Hit testing against non-<xref:System.Windows.UIElement> objects: This applies if you are hit testing non-<xref:System.Windows.UIElement> objects, such as <xref:System.Windows.Media.DrawingVisual> or graphics objects.</span></span>  
  
- <span data-ttu-id="31a63-110">使用几何进行命中测试：适用于需要使用几何对象而不是点的坐标值进行命中测试。</span><span class="sxs-lookup"><span data-stu-id="31a63-110">Hit testing using a geometry: This applies if you need to hit test using a geometry object rather than the coordinate value of a point.</span></span>  
  
- <span data-ttu-id="31a63-111">针对多个对象进行命中测试：适用于需要针对多个对象（如重叠的对象）进行命中测试。</span><span class="sxs-lookup"><span data-stu-id="31a63-111">Hit testing against multiple objects: This applies when you need to hit test against multiple objects, such as overlapping objects.</span></span> <span data-ttu-id="31a63-112">可以获取与几何或点相交的所有视觉对象的结果，而不仅仅是第一个视觉对象的结果。</span><span class="sxs-lookup"><span data-stu-id="31a63-112">You can get results for all visuals intersecting a geometry or point, not just the first one.</span></span>  
  
- <span data-ttu-id="31a63-113">正在忽略 <xref:System.Windows.UIElement> 命中测试策略：这适用于需要忽略 <xref:System.Windows.UIElement> 命中测试策略的情况，这会考虑元素是禁用还是不可见。</span><span class="sxs-lookup"><span data-stu-id="31a63-113">Ignoring <xref:System.Windows.UIElement> hit testing policy: This applies when you need to ignore the <xref:System.Windows.UIElement> hit testing policy, which takes into consideration such factors as whether an element is disabled or invisible.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="31a63-114">有关演示在可视化层上进行命中测试的完整代码示例，请参阅[使用 DrawingVisuals 进行命中测试示例](https://github.com/Microsoft/WPF-Samples/tree/master/Visual%20Layer/DrawingVisual)和[使用 Win32 互操作进行命中测试示例](https://github.com/microsoft/WPF-Samples/tree/master/Visual%20Layer/VisualsHitTesting)。</span><span class="sxs-lookup"><span data-stu-id="31a63-114">For a complete code sample illustrating hit testing at the visual layer, see [Hit Test Using DrawingVisuals Sample](https://github.com/Microsoft/WPF-Samples/tree/master/Visual%20Layer/DrawingVisual) and [Hit Test with Win32 Interoperation Sample](https://github.com/microsoft/WPF-Samples/tree/master/Visual%20Layer/VisualsHitTesting).</span></span>  
  
<a name="hit_testing_support"></a>
## <a name="hit-testing-support"></a><span data-ttu-id="31a63-115">命中测试支持</span><span class="sxs-lookup"><span data-stu-id="31a63-115">Hit Testing Support</span></span>  
 <span data-ttu-id="31a63-116"><xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>类中方法的用途 <xref:System.Windows.Media.VisualTreeHelper> 是确定几何或点坐标值是否在给定对象（如控件或图形元素）的呈现内容中。</span><span class="sxs-lookup"><span data-stu-id="31a63-116">The purpose of the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> methods in the <xref:System.Windows.Media.VisualTreeHelper> class is to determine whether a geometry or point coordinate value is within the rendered content of a given object, such as a control or graphic element.</span></span> <span data-ttu-id="31a63-117">例如，可以使用命中测试确定对象边框内的鼠标单击是否落在圆形的几何内。</span><span class="sxs-lookup"><span data-stu-id="31a63-117">For example, you could use hit testing to determine whether a mouse click within the bounding rectangle of an object falls within the geometry of a circle.</span></span> <span data-ttu-id="31a63-118">还可以选择重写命中测试的默认实现，以执行自己的自定义命中测试计算。</span><span class="sxs-lookup"><span data-stu-id="31a63-118">You can also choose to override the default implementation of hit testing to perform your own custom hit test calculations.</span></span>  
  
 <span data-ttu-id="31a63-119">下图显示非矩形对象的区域与其边框之间的关系。</span><span class="sxs-lookup"><span data-stu-id="31a63-119">The following illustration shows the relationship between a non-rectangular object's region and its bounding rectangle.</span></span>  
  
 <span data-ttu-id="31a63-120">![有效命中测试区域示意图](./media/wcpsdk-mmgraphics-visuals-hittest-1.png "wcpsdk_mmgraphics_visuals_hittest_1")</span><span class="sxs-lookup"><span data-stu-id="31a63-120">![Diagram of valid hit test region](./media/wcpsdk-mmgraphics-visuals-hittest-1.png "wcpsdk_mmgraphics_visuals_hittest_1")</span></span>  
<span data-ttu-id="31a63-121">有效命中测试区域示意图</span><span class="sxs-lookup"><span data-stu-id="31a63-121">Diagram of valid hit test region</span></span>  
  
<a name="hit_testing_and_z-order"></a>
## <a name="hit-testing-and-z-order"></a><span data-ttu-id="31a63-122">命中测试和 Z 顺序</span><span class="sxs-lookup"><span data-stu-id="31a63-122">Hit Testing and Z-Order</span></span>  
 <span data-ttu-id="31a63-123">[!INCLUDE[TLA#tla_winclient](../../../includes/tlasharptla-winclient-md.md)] 可视化层支持针对点或几何下的所有对象（而不仅仅是最顶层对象）进行命中测试。</span><span class="sxs-lookup"><span data-stu-id="31a63-123">The [!INCLUDE[TLA#tla_winclient](../../../includes/tlasharptla-winclient-md.md)] visual layer supports hit testing against all objects under a point or geometry, not just the top-most object.</span></span> <span data-ttu-id="31a63-124">结果按 z 顺序返回。</span><span class="sxs-lookup"><span data-stu-id="31a63-124">Results are returned in z-order.</span></span> <span data-ttu-id="31a63-125">但是，作为参数传递给方法的视觉对象 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> 将确定要进行命中测试的可视化树部分。</span><span class="sxs-lookup"><span data-stu-id="31a63-125">However, the visual object that you pass as the parameter to the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method determines which portion of the visual tree that will be hit test.</span></span> <span data-ttu-id="31a63-126">可以针对整个可视化树或它的任意部分进行命中测试。</span><span class="sxs-lookup"><span data-stu-id="31a63-126">You can hit test against the entire visual tree, or any portion of it.</span></span>  
  
 <span data-ttu-id="31a63-127">在下图中，圆形对象在正方形和三角形对象之上。</span><span class="sxs-lookup"><span data-stu-id="31a63-127">In the following illustration, the circle object is on top of both the square and triangle objects.</span></span> <span data-ttu-id="31a63-128">如果你只想对其 z 顺序值最顶层的视觉对象进行命中测试，则可以设置从中返回的可视命中测试枚举， <xref:System.Windows.Media.HitTestResultBehavior.Stop> <xref:System.Windows.Media.HitTestResultCallback> 以便在第一项之后停止命中测试遍历。</span><span class="sxs-lookup"><span data-stu-id="31a63-128">If you are only interested in hit testing the visual object whose z-order value is top-most, you can set the visual hit test enumeration to return <xref:System.Windows.Media.HitTestResultBehavior.Stop> from the <xref:System.Windows.Media.HitTestResultCallback> to stop the hit test traversal after the first item.</span></span>  
  
 <span data-ttu-id="31a63-129">![可视化树的 z 顺序关系图](./media/wcpsdk-mmgraphics-visuals-hittest-2.png "wcpsdk_mmgraphics_visuals_hittest_2")</span><span class="sxs-lookup"><span data-stu-id="31a63-129">![Diagram of the z&#45;order of a visual tree](./media/wcpsdk-mmgraphics-visuals-hittest-2.png "wcpsdk_mmgraphics_visuals_hittest_2")</span></span>  
<span data-ttu-id="31a63-130">可视化树的 z 顺序示意图</span><span class="sxs-lookup"><span data-stu-id="31a63-130">Diagram of the z-order of a visual tree</span></span>  
  
 <span data-ttu-id="31a63-131">如果要枚举特定点或几何图形下的所有视觉对象，请从返回 <xref:System.Windows.Media.HitTestResultBehavior.Continue> <xref:System.Windows.Media.HitTestResultCallback> 。</span><span class="sxs-lookup"><span data-stu-id="31a63-131">If you want to enumerate all visual objects under a specific point or geometry, return <xref:System.Windows.Media.HitTestResultBehavior.Continue> from the <xref:System.Windows.Media.HitTestResultCallback>.</span></span> <span data-ttu-id="31a63-132">这意味着可以为其他对象之下的视觉对象进行命中测试，即使它们被完全遮挡也是如此。</span><span class="sxs-lookup"><span data-stu-id="31a63-132">This means you can hit test for visual objects that are beneath other objects, even if they are wholly obscured.</span></span> <span data-ttu-id="31a63-133">有关详细信息，请参阅“使用命中测试结果回叫”部分中的示例代码。</span><span class="sxs-lookup"><span data-stu-id="31a63-133">See the sample code in the section "Using a Hit Test Results Callback" for more information.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="31a63-134">还可以对透明的视觉对象进行命中测试。</span><span class="sxs-lookup"><span data-stu-id="31a63-134">A visual object that is transparent can also be hit test.</span></span>  
  
<a name="using_default_hit_testing"></a>
## <a name="using-default-hit-testing"></a><span data-ttu-id="31a63-135">使用默认命中测试</span><span class="sxs-lookup"><span data-stu-id="31a63-135">Using Default Hit Testing</span></span>  
 <span data-ttu-id="31a63-136">您可以通过使用 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> 方法指定要对其进行测试的视觉对象和点坐标值，来识别某个点是否在可视对象的几何图形内。</span><span class="sxs-lookup"><span data-stu-id="31a63-136">You can identify whether a point is within the geometry of a visual object, by using the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method to specify a visual object and a point coordinate value to test against.</span></span> <span data-ttu-id="31a63-137">视觉对象参数为命中测试搜索确定可视化树中的起始点。</span><span class="sxs-lookup"><span data-stu-id="31a63-137">The visual object parameter identifies the starting point in the visual tree for the hit test search.</span></span> <span data-ttu-id="31a63-138">如果在可视化树中找到的可视对象的几何图形包含坐标，则将其设置为对象的 <xref:System.Windows.Media.HitTestResult.VisualHit%2A> 属性 <xref:System.Windows.Media.HitTestResult> 。</span><span class="sxs-lookup"><span data-stu-id="31a63-138">If a visual object is found in the visual tree whose geometry contains the coordinate, it is set to the <xref:System.Windows.Media.HitTestResult.VisualHit%2A> property of a <xref:System.Windows.Media.HitTestResult> object.</span></span> <span data-ttu-id="31a63-139"><xref:System.Windows.Media.HitTestResult>然后，从 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> 方法返回。</span><span class="sxs-lookup"><span data-stu-id="31a63-139">The <xref:System.Windows.Media.HitTestResult> is then returned from the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span> <span data-ttu-id="31a63-140">如果点不包含在要进行命中测试的可视化子树中，则 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> 返回 `null` 。</span><span class="sxs-lookup"><span data-stu-id="31a63-140">If the point is not contained with the visual sub-tree you are hit testing, <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> returns `null`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="31a63-141">默认命中测试始终返回 z 顺序中最顶层的对象。</span><span class="sxs-lookup"><span data-stu-id="31a63-141">Default hit testing always returns the top-most object in the z-order.</span></span> <span data-ttu-id="31a63-142">为了标识所有视觉对象（甚至是被部分或完全遮挡的视觉对象），请使用命中测试结果回叫。</span><span class="sxs-lookup"><span data-stu-id="31a63-142">In order to identify all visual objects, even those that may be partly or wholly obscured, use a hit test result callback.</span></span>  
  
 <span data-ttu-id="31a63-143">作为方法的 point 参数传递的坐标值必须相对于要 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> 进行命中测试的视觉对象的坐标空间。</span><span class="sxs-lookup"><span data-stu-id="31a63-143">The coordinate value you pass as the point parameter for the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method has to be relative to the coordinate space of the visual object you are hit testing against.</span></span> <span data-ttu-id="31a63-144">例如，如果在父级坐标空间的 (100, 100) 处定义了嵌套可视化对象，则对位于 (0, 0) 的子视觉对象进行命中测试等效于对父级坐标空间的 (100, 100) 处的子视觉对象进行命中测试。</span><span class="sxs-lookup"><span data-stu-id="31a63-144">For example, if you have nested visual objects defined at (100, 100) in the parent's coordinate space, then hit testing a child visual at (0, 0) is equivalent to hit testing at (100, 100) in the parent's coordinate space.</span></span>  
  
 <span data-ttu-id="31a63-145">下面的代码演示如何为 <xref:System.Windows.UIElement> 用于捕获用于命中测试的事件的对象设置鼠标事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="31a63-145">The following code shows how to set up mouse event handlers for a <xref:System.Windows.UIElement> object that is used to capture events used for hit testing.</span></span>  
  
 [!code-csharp[HitTestingOverview#100](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#100)]
 [!code-vb[HitTestingOverview#100](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#100)]  
  
### <a name="how-the-visual-tree-affects-hit-testing"></a><span data-ttu-id="31a63-146">可视化树如何影响命中测试</span><span class="sxs-lookup"><span data-stu-id="31a63-146">How the Visual Tree Affects Hit Testing</span></span>  
 <span data-ttu-id="31a63-147">可视化树中的起始点确定在对象的命中测试枚举期间返回哪些对象。</span><span class="sxs-lookup"><span data-stu-id="31a63-147">The starting point in the visual tree determines which objects are returned during the hit test enumeration of objects.</span></span> <span data-ttu-id="31a63-148">如果要对多个对象进行命中测试，在可视化树中用作起始点的视觉对象必须是所有相关对象的公共上级。</span><span class="sxs-lookup"><span data-stu-id="31a63-148">If you have multiple objects you want to hit test, the visual object used as the starting point in the visual tree must be the common ancestor of all objects of interest.</span></span> <span data-ttu-id="31a63-149">例如，如果希望对以下关系图中的按钮元素和绘图视觉对象进行命中测试，必须将可视化树中的起始点设置为两者的公共上级。</span><span class="sxs-lookup"><span data-stu-id="31a63-149">For example, if you were interested in hit testing both the button element and drawing visual in the following diagram, you would have to set the starting point in the visual tree to the common ancestor of both.</span></span> <span data-ttu-id="31a63-150">在这种情况下，画布元素是按钮元素和绘图视觉对象的公共上级。</span><span class="sxs-lookup"><span data-stu-id="31a63-150">In this case, the canvas element is the common ancestor of both the button element and the drawing visual.</span></span>  
  
 <span data-ttu-id="31a63-151">![可视化树的层次结构示意图](./media/wcpsdk-mmgraphics-visuals-overview-01.gif "wcpsdk_mmgraphics_visuals_overview_01")</span><span class="sxs-lookup"><span data-stu-id="31a63-151">![Diagram of a visual tree hierarchy](./media/wcpsdk-mmgraphics-visuals-overview-01.gif "wcpsdk_mmgraphics_visuals_overview_01")</span></span>  
<span data-ttu-id="31a63-152">可视化树的层次结构示意图</span><span class="sxs-lookup"><span data-stu-id="31a63-152">Diagram of a visual tree hierarchy</span></span>  
  
> [!NOTE]
> <span data-ttu-id="31a63-153"><xref:System.Windows.UIElement.IsHitTestVisible%2A>属性获取或设置一个值，该值声明派生的 <xref:System.Windows.UIElement> 对象是否可以作为其呈现内容的某些部分的命中测试结果返回。</span><span class="sxs-lookup"><span data-stu-id="31a63-153">The <xref:System.Windows.UIElement.IsHitTestVisible%2A> property gets or sets a value that declares whether a <xref:System.Windows.UIElement>-derived object can possibly be returned as a hit test result from some portion of its rendered content.</span></span> <span data-ttu-id="31a63-154">这使用户可以选择性地更改可视化树，以确定命中测试涉及哪些视觉对象。</span><span class="sxs-lookup"><span data-stu-id="31a63-154">This allows you to selectively alter the visual tree to determine which visual objects are involved in a hit test.</span></span>  
  
<a name="using_a_hit_test_result_callback"></a>
## <a name="using-a-hit-test-result-callback"></a><span data-ttu-id="31a63-155">使用命中测试结果回叫</span><span class="sxs-lookup"><span data-stu-id="31a63-155">Using a Hit Test Result Callback</span></span>  
 <span data-ttu-id="31a63-156">可以在可视化树中枚举其几何包含特定坐标值的所有视觉对象。</span><span class="sxs-lookup"><span data-stu-id="31a63-156">You can enumerate all visual objects in a visual tree whose geometry contains a specified coordinate value.</span></span> <span data-ttu-id="31a63-157">这使用户可以标识所有视觉对象（甚至是被其他视觉对象部分或完全遮挡的视觉对象）。</span><span class="sxs-lookup"><span data-stu-id="31a63-157">This allows you to identify all visual objects, even those that may be partly or wholly obscured by other visual objects.</span></span> <span data-ttu-id="31a63-158">若要枚举可视化树中的可视化对象，请使用 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> 带有命中测试回调函数的方法。</span><span class="sxs-lookup"><span data-stu-id="31a63-158">To enumerate visual objects in a visual tree use the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method with a hit test callback function.</span></span> <span data-ttu-id="31a63-159">当指定的坐标值包含在视觉对象中时，系统会调用命中测试回叫函数。</span><span class="sxs-lookup"><span data-stu-id="31a63-159">The hit test callback function is called by the system when the coordinate value you specify is contained in a visual object.</span></span>  
  
 <span data-ttu-id="31a63-160">在命中测试结果枚举期间，不应执行任何修改可视化树的操作。</span><span class="sxs-lookup"><span data-stu-id="31a63-160">During the hit test results enumeration, you should not perform any operation that modifies the visual tree.</span></span> <span data-ttu-id="31a63-161">在遍历可视化树的过程中，在可视化树中添加或删除对象可能会导致不可预知的行为。</span><span class="sxs-lookup"><span data-stu-id="31a63-161">Adding or removing an object from the visual tree while it is being traversed can result in unpredictable behavior.</span></span> <span data-ttu-id="31a63-162">在方法返回后，可以安全地修改可视化树 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> 。</span><span class="sxs-lookup"><span data-stu-id="31a63-162">You can safely modify the visual tree after the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method returns.</span></span> <span data-ttu-id="31a63-163">你可能需要提供数据结构（如 <xref:System.Collections.ArrayList> ），以便在命中测试结果枚举过程中存储值。</span><span class="sxs-lookup"><span data-stu-id="31a63-163">You may want to provide a data structure, such as an <xref:System.Collections.ArrayList>, to store values during the hit test results enumeration.</span></span>  
  
 [!code-csharp[HitTestingOverview#101](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#101)]
 [!code-vb[HitTestingOverview#101](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#101)]  
  
 <span data-ttu-id="31a63-164">命中测试回叫方法定义在可视化树中的特定视觉对象上标识命中测试时要执行的操作。</span><span class="sxs-lookup"><span data-stu-id="31a63-164">The hit test callback method defines the actions you perform when a hit test is identified on a particular visual object in the visual tree.</span></span> <span data-ttu-id="31a63-165">执行这些操作后，将返回一个 <xref:System.Windows.Media.HitTestResultBehavior> 值，该值确定是否继续枚举任何其他视觉对象。</span><span class="sxs-lookup"><span data-stu-id="31a63-165">After you perform the actions, you return a <xref:System.Windows.Media.HitTestResultBehavior> value that determines whether to continue the enumeration of any other visual objects or not.</span></span>  
  
 [!code-csharp[HitTestingOverview#102](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#102)]
 [!code-vb[HitTestingOverview#102](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#102)]  
  
> [!NOTE]
> <span data-ttu-id="31a63-166">命中视觉对象的枚举顺序为 z 顺序。</span><span class="sxs-lookup"><span data-stu-id="31a63-166">The order of enumeration of hit visual objects is by z-order.</span></span> <span data-ttu-id="31a63-167">位于最顶层 z 顺序级别上的视觉对象是第一个枚举的对象。</span><span class="sxs-lookup"><span data-stu-id="31a63-167">The visual object at the top-most z-order level is the first object enumerated.</span></span> <span data-ttu-id="31a63-168">所有其他视觉对象按递减的 z 顺序级别进行枚举。</span><span class="sxs-lookup"><span data-stu-id="31a63-168">Any other visual objects enumerated are at decreasing z-order level.</span></span> <span data-ttu-id="31a63-169">此枚举顺序对应于视觉对象的呈现顺序。</span><span class="sxs-lookup"><span data-stu-id="31a63-169">This order of enumeration corresponds to the rendering order of the visuals.</span></span>  
  
 <span data-ttu-id="31a63-170">你可以通过返回来随时停止命中测试回调函数中的视觉对象的枚举 <xref:System.Windows.Media.HitTestResultBehavior.Stop> 。</span><span class="sxs-lookup"><span data-stu-id="31a63-170">You can stop the enumeration of visual objects at any time in the hit test callback function by returning <xref:System.Windows.Media.HitTestResultBehavior.Stop>.</span></span>  
  
 [!code-csharp[HitTestingOverview#103](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#103)]
 [!code-vb[HitTestingOverview#103](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#103)]  
  
<a name="using_a_hit_test_filter_callback"></a>
## <a name="using-a-hit-test-filter-callback"></a><span data-ttu-id="31a63-171">使用命中测试筛选器回叫</span><span class="sxs-lookup"><span data-stu-id="31a63-171">Using a Hit Test Filter Callback</span></span>  
 <span data-ttu-id="31a63-172">可使用可选的命中测试筛选器来限制传递给命中测试结果的对象。</span><span class="sxs-lookup"><span data-stu-id="31a63-172">You can use an optional hit test filter to restrict the objects that are passed on to the hit test results.</span></span> <span data-ttu-id="31a63-173">这样一来，你便可以在处理命中测试结果时忽略可视化树中的无关部分。</span><span class="sxs-lookup"><span data-stu-id="31a63-173">This allows you to ignore parts of the visual tree that you are not interested in processing in your hit test results.</span></span> <span data-ttu-id="31a63-174">若要实现命中测试筛选器，请定义命中测试筛选器回调函数并在调用方法时将其作为参数值传递 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> 。</span><span class="sxs-lookup"><span data-stu-id="31a63-174">To implement a hit test filter, you define a hit test filter callback function and pass it as a parameter value when you call the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span>  
  
 [!code-csharp[HitTestingOverview#104](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#104)]
 [!code-vb[HitTestingOverview#104](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#104)]  
  
 <span data-ttu-id="31a63-175">如果你不希望提供可选的命中测试筛选器回调函数，请将 `null` 值作为其参数传递给该 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="31a63-175">If you do not want to supply the optional hit test filter callback function, pass a `null` value as its parameter for the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span>  
  
 [!code-csharp[HitTestingOverview#105](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#105)]
 [!code-vb[HitTestingOverview#105](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#105)]  
  
 <span data-ttu-id="31a63-176">![使用命中测试筛选器修剪可视化树](./media/filteredvisualtree-01.png "FilteredVisualTree_01")</span><span class="sxs-lookup"><span data-stu-id="31a63-176">![Pruning a visual tree using a hit test filter](./media/filteredvisualtree-01.png "FilteredVisualTree_01")</span></span>  
<span data-ttu-id="31a63-177">修剪可视化树</span><span class="sxs-lookup"><span data-stu-id="31a63-177">Pruning a visual tree</span></span>  
  
 <span data-ttu-id="31a63-178">借助命中测试筛选器回叫函数，可以允许枚举呈现内容包含指定坐标的所有视觉对象。</span><span class="sxs-lookup"><span data-stu-id="31a63-178">The hit test filter callback function allows you to enumerate through all the visuals whose rendered content contains the coordinates you specify.</span></span> <span data-ttu-id="31a63-179">但是，你可能要忽略不希望在命中测试结果回调叫函数中处理的可视化树的某些分支。</span><span class="sxs-lookup"><span data-stu-id="31a63-179">However, you may want to ignore certain branches of the visual tree that you are not interested in processing in your hit test results callback function.</span></span> <span data-ttu-id="31a63-180">命中测试筛选器回叫函数的返回值确定视觉对象的枚举应采用的操作类型。</span><span class="sxs-lookup"><span data-stu-id="31a63-180">The return value of the hit test filter callback function determines what type of action the enumeration of the visual objects should take.</span></span> <span data-ttu-id="31a63-181">例如，如果返回值， <xref:System.Windows.Media.HitTestFilterBehavior.ContinueSkipSelfAndChildren> 则可以从命中测试结果枚举中删除当前的可视对象及其子对象。</span><span class="sxs-lookup"><span data-stu-id="31a63-181">For example, if you return the value, <xref:System.Windows.Media.HitTestFilterBehavior.ContinueSkipSelfAndChildren>, you can remove the current visual object and its children from the hit test results enumeration.</span></span> <span data-ttu-id="31a63-182">这意味着，命中测试结果回叫函数不会在其枚举中看到这些对象。</span><span class="sxs-lookup"><span data-stu-id="31a63-182">This means that the hit test results callback function will not see these objects in its enumeration.</span></span> <span data-ttu-id="31a63-183">修剪对象的可视化树会减少命中测试结果枚举传递期间的处理量。</span><span class="sxs-lookup"><span data-stu-id="31a63-183">Pruning the visual tree of objects decreases the amount of processing during the hit test results enumeration pass.</span></span> <span data-ttu-id="31a63-184">在以下代码示例中，筛选器会跳过标签及其后代，并对其他所有内容进行命中测试。</span><span class="sxs-lookup"><span data-stu-id="31a63-184">In the following code example, the filter skips labels and their descendants and hit tests everything else.</span></span>  
  
 [!code-csharp[HitTestingOverview#106](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#106)]
 [!code-vb[HitTestingOverview#106](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#106)]  
  
> [!NOTE]
> <span data-ttu-id="31a63-185">在未调用命中测试结果回叫的情况下，有时会调用命中测试筛选器回叫。</span><span class="sxs-lookup"><span data-stu-id="31a63-185">The hit test filter callback will sometimes be called in cases where the hit test results callback is not called.</span></span>  
  
<a name="overriding_default_hit_testing"></a>
## <a name="overriding-default-hit-testing"></a><span data-ttu-id="31a63-186">重写默认命中测试</span><span class="sxs-lookup"><span data-stu-id="31a63-186">Overriding Default Hit Testing</span></span>  
 <span data-ttu-id="31a63-187">您可以通过重写方法来重写可视对象的默认命中测试支持 <xref:System.Windows.Media.Visual.HitTestCore%2A> 。</span><span class="sxs-lookup"><span data-stu-id="31a63-187">You can override a visual object’s default hit testing support by overriding the <xref:System.Windows.Media.Visual.HitTestCore%2A> method.</span></span> <span data-ttu-id="31a63-188">这意味着，当你调用 <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> 方法时，将调用的重写实现 <xref:System.Windows.Media.Visual.HitTestCore%2A> 。</span><span class="sxs-lookup"><span data-stu-id="31a63-188">This means that when you invoke the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method, your overridden implementation of <xref:System.Windows.Media.Visual.HitTestCore%2A> is called.</span></span> <span data-ttu-id="31a63-189">当命中测试落在视觉对象的边框内时，将调用重写的方法，即使坐标落在视觉对象呈现内容之外也是如此。</span><span class="sxs-lookup"><span data-stu-id="31a63-189">Your overridden method is called when a hit test falls within the bounding rectangle of the visual object, even if the coordinate falls outside the rendered content of the visual object.</span></span>  
  
 [!code-csharp[HitTestingOverview#107](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#107)]
 [!code-vb[HitTestingOverview#107](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#107)]  
  
 <span data-ttu-id="31a63-190">有时你可能希望针对视觉对象的边框和呈现内容进行命中测试。</span><span class="sxs-lookup"><span data-stu-id="31a63-190">There may be times when you want to hit test against both the bounding rectangle and the rendered content of a visual object.</span></span> <span data-ttu-id="31a63-191">通过使用 `PointHitTestParameters` 重写的方法中的参数值 <xref:System.Windows.Media.Visual.HitTestCore%2A> 作为基方法的参数 <xref:System.Windows.Media.Visual.HitTestCore%2A> ，你可以根据视觉对象的边框的命中来执行操作，然后针对视觉对象的呈现内容执行第二个命中测试。</span><span class="sxs-lookup"><span data-stu-id="31a63-191">By using the `PointHitTestParameters` parameter value in your overridden <xref:System.Windows.Media.Visual.HitTestCore%2A> method as the parameter to the base method <xref:System.Windows.Media.Visual.HitTestCore%2A>, you can perform actions based on a hit of the bounding rectangle of a visual object, and then perform a second hit test against the rendered content of the visual object.</span></span>  
  
 [!code-csharp[HitTestingOverview#108](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#108)]
 [!code-vb[HitTestingOverview#108](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#108)]  
  
## <a name="see-also"></a><span data-ttu-id="31a63-192">另请参阅</span><span class="sxs-lookup"><span data-stu-id="31a63-192">See also</span></span>

- <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>
- <xref:System.Windows.Media.HitTestResult>
- <xref:System.Windows.Media.HitTestResultCallback>
- <xref:System.Windows.Media.HitTestFilterCallback>
- <xref:System.Windows.UIElement.IsHitTestVisible%2A>
- [<span data-ttu-id="31a63-193">使用 DrawingVisuals 进行命中操作示例</span><span class="sxs-lookup"><span data-stu-id="31a63-193">Hit Test Using DrawingVisuals Sample</span></span>](https://github.com/Microsoft/WPF-Samples/tree/master/Visual%20Layer/DrawingVisual)
- [<span data-ttu-id="31a63-194">使用 Win32 互操作进行命中测试示例</span><span class="sxs-lookup"><span data-stu-id="31a63-194">Hit Test with Win32 Interoperation Sample</span></span>](https://github.com/microsoft/WPF-Samples/tree/master/Visual%20Layer/VisualsHitTesting)
- [<span data-ttu-id="31a63-195">对视觉对象中的几何图形进行命中测试</span><span class="sxs-lookup"><span data-stu-id="31a63-195">Hit Test Geometry in a Visual</span></span>](how-to-hit-test-geometry-in-a-visual.md)
- [<span data-ttu-id="31a63-196">使用 Win32 宿主容器进行命中测试</span><span class="sxs-lookup"><span data-stu-id="31a63-196">Hit Test Using a Win32 Host Container</span></span>](how-to-hit-test-using-a-win32-host-container.md)
