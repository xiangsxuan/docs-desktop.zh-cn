---
title: 如何：确定此时是否可以打印一项打印作业
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- print queues [WPF], timing
- printers [WPF], availability
- print jobs [WPF], timing
ms.assetid: 7e9c8ec1-abf6-4b3d-b1c6-33b35d3c4063
ms.openlocfilehash: 859dc75169e443d07361951692a428507886fa2e
ms.sourcegitcommit: 9f6df084c53a3da0ea657ed0d708a72213683084
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/09/2020
ms.locfileid: "96973491"
---
# <a name="how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day"></a><span data-ttu-id="be40b-102">如何：确定此时是否可以打印一项打印作业</span><span class="sxs-lookup"><span data-stu-id="be40b-102">How to: Discover Whether a Print Job Can Be Printed At This Time of Day</span></span>
<span data-ttu-id="be40b-103">打印队列并非每日24小时始终可用。</span><span class="sxs-lookup"><span data-stu-id="be40b-103">Print queues are not always available for 24 hours a day.</span></span> <span data-ttu-id="be40b-104">它们具有 "开始时间" 和 "结束时间" 属性，可将其设置为在一天中的特定时间使其不可用。</span><span class="sxs-lookup"><span data-stu-id="be40b-104">They have start and end time properties that can be set to make them unavailable at certain times of day.</span></span> <span data-ttu-id="be40b-105">例如，可以使用此功能在下午5点后预留打印机以供特定部门独占使用。</span><span class="sxs-lookup"><span data-stu-id="be40b-105">This feature can be used, for example, to reserve a printer for the exclusive use of a certain department after 5 P.M..</span></span> <span data-ttu-id="be40b-106">该部门与其他部门使用不同的队列来处理打印机。</span><span class="sxs-lookup"><span data-stu-id="be40b-106">That department would have a different queue servicing the printer than other departments use.</span></span> <span data-ttu-id="be40b-107">其他部门的队列在下午5点后将被设置为不可用，而受欢迎部门的队列可设置为随时可用。</span><span class="sxs-lookup"><span data-stu-id="be40b-107">The queue for the other departments would be set to be unavailable after 5 P.M., while queue for the favored department could be set to be available at all times.</span></span>  
  
 <span data-ttu-id="be40b-108">此外，打印作业本身可以设置为仅在指定的时间范围内可打印。</span><span class="sxs-lookup"><span data-stu-id="be40b-108">Moreover, print jobs themselves can be set to be printable only within a specified span of time.</span></span>  
  
 <span data-ttu-id="be40b-109"><xref:System.Printing.PrintQueue> <xref:System.Printing.PrintSystemJobInfo> 在 Microsoft .NET 框架的 api 中公开的和类提供一种远程检查给定的打印作业是否可以在指定的队列上打印的方法。</span><span class="sxs-lookup"><span data-stu-id="be40b-109">The <xref:System.Printing.PrintQueue> and <xref:System.Printing.PrintSystemJobInfo> classes exposed in the APIs of Microsoft .NET Framework provide a means for remotely checking whether a given print job can print on a given queue at the current time.</span></span>  
  
## <a name="example"></a><span data-ttu-id="be40b-110">示例</span><span class="sxs-lookup"><span data-stu-id="be40b-110">Example</span></span>  
 <span data-ttu-id="be40b-111">下面的示例是一个可诊断打印作业问题的示例。</span><span class="sxs-lookup"><span data-stu-id="be40b-111">The example below is a sample that can diagnose problems with a print job.</span></span>  
  
 <span data-ttu-id="be40b-112">下面是此类函数的两个主要步骤。</span><span class="sxs-lookup"><span data-stu-id="be40b-112">There are two major steps for this kind of function as follows.</span></span>  
  
1. <span data-ttu-id="be40b-113">读取 <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> 的和 <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> 属性， <xref:System.Printing.PrintQueue> 以确定当前时间是否介于两者之间。</span><span class="sxs-lookup"><span data-stu-id="be40b-113">Read the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties of the <xref:System.Printing.PrintQueue> to determine whether the current time is between them.</span></span>  
  
2. <span data-ttu-id="be40b-114">读取 <xref:System.Printing.PrintSystemJobInfo.StartTimeOfDay%2A> 的和 <xref:System.Printing.PrintSystemJobInfo.UntilTimeOfDay%2A> 属性， <xref:System.Printing.PrintSystemJobInfo> 以确定当前时间是否介于两者之间。</span><span class="sxs-lookup"><span data-stu-id="be40b-114">Read the <xref:System.Printing.PrintSystemJobInfo.StartTimeOfDay%2A> and <xref:System.Printing.PrintSystemJobInfo.UntilTimeOfDay%2A> properties of the <xref:System.Printing.PrintSystemJobInfo> to determine whether the current time is between them.</span></span>  
  
 <span data-ttu-id="be40b-115">但这种情况很复杂，这是因为这些属性不是 <xref:System.DateTime> 对象。</span><span class="sxs-lookup"><span data-stu-id="be40b-115">But complications arise from the fact that these properties are not <xref:System.DateTime> objects.</span></span> <span data-ttu-id="be40b-116">相反，它们是表示 <xref:System.Int32> 当天自午夜以来的时间间隔的对象。</span><span class="sxs-lookup"><span data-stu-id="be40b-116">Instead they are <xref:System.Int32> objects that express the time of day as the number of minutes since midnight.</span></span> <span data-ttu-id="be40b-117">此外，此时间不是当前时区的午夜，而是午夜 UTC (协调世界时) 。</span><span class="sxs-lookup"><span data-stu-id="be40b-117">Moreover, this is not midnight in the current time zone, but midnight UTC (Coordinated Universal Time).</span></span>  
  
 <span data-ttu-id="be40b-118">第一个代码示例演示了 **ReportQueueAndJobAvailability** 的静态方法，该方法传递了 <xref:System.Printing.PrintSystemJobInfo> 并调用帮助程序方法来确定作业是否可以在当前时间打印，如果不能打印，则调用。</span><span class="sxs-lookup"><span data-stu-id="be40b-118">The first code example presents the static method **ReportQueueAndJobAvailability**, which is passed a <xref:System.Printing.PrintSystemJobInfo> and calls helper methods to determine whether the job can print at the current time and, if not, when it can print.</span></span> <span data-ttu-id="be40b-119">请注意， <xref:System.Printing.PrintQueue> 不会传递给方法。</span><span class="sxs-lookup"><span data-stu-id="be40b-119">Notice that a <xref:System.Printing.PrintQueue> is not passed to the method.</span></span> <span data-ttu-id="be40b-120">这是因为在 <xref:System.Printing.PrintSystemJobInfo> 其属性中包含对队列的引用 <xref:System.Printing.PrintSystemJobInfo.HostingPrintQueue%2A> 。</span><span class="sxs-lookup"><span data-stu-id="be40b-120">This is because the <xref:System.Printing.PrintSystemJobInfo> includes a reference to the queue in its <xref:System.Printing.PrintSystemJobInfo.HostingPrintQueue%2A> property.</span></span>  
  
 <span data-ttu-id="be40b-121">从属方法包括重载的 **ReportAvailabilityAtThisTime** 方法，该方法可以采用 <xref:System.Printing.PrintQueue> 或 <xref:System.Printing.PrintSystemJobInfo> 作为参数。</span><span class="sxs-lookup"><span data-stu-id="be40b-121">The subordinate methods include the overloaded **ReportAvailabilityAtThisTime** method which can take either a <xref:System.Printing.PrintQueue> or a <xref:System.Printing.PrintSystemJobInfo> as a parameter.</span></span> <span data-ttu-id="be40b-122">还有一个 **TimeConverter。 ConvertToLocalHumanReadableTime**。</span><span class="sxs-lookup"><span data-stu-id="be40b-122">There is also a **TimeConverter.ConvertToLocalHumanReadableTime**.</span></span> <span data-ttu-id="be40b-123">下面讨论所有这些方法。</span><span class="sxs-lookup"><span data-stu-id="be40b-123">All of these methods are discussed below.</span></span>  
  
 <span data-ttu-id="be40b-124">**ReportQueueAndJobAvailability** 方法首先检查队列或打印作业此时是否不可用。</span><span class="sxs-lookup"><span data-stu-id="be40b-124">The **ReportQueueAndJobAvailability** method begins by checking to see if either the queue or the print job is unavailable at this time.</span></span> <span data-ttu-id="be40b-125">如果其中任何一个不可用，则它会检查队列是否不可用。</span><span class="sxs-lookup"><span data-stu-id="be40b-125">If either of them is unavailable, it then checks to see if the queue unavailable.</span></span> <span data-ttu-id="be40b-126">如果它不可用，则方法会报告此事实以及队列将再次变为可用的时间。</span><span class="sxs-lookup"><span data-stu-id="be40b-126">If it is not available, then the method reports this fact and the time when the queue will become available again.</span></span> <span data-ttu-id="be40b-127">然后，它会检查作业，如果该作业不可用，它将在它可以打印时报告下一个时间跨度。</span><span class="sxs-lookup"><span data-stu-id="be40b-127">It then checks the job and if it is unavailable, it reports the next time span when it when it can print.</span></span> <span data-ttu-id="be40b-128">最后，该方法将报告作业可以打印的最早时间。</span><span class="sxs-lookup"><span data-stu-id="be40b-128">Finally, the method reports the earliest time when the job can print.</span></span> <span data-ttu-id="be40b-129">这是以下两次的后续版本。</span><span class="sxs-lookup"><span data-stu-id="be40b-129">This is the later of following two times.</span></span>  
  
- <span data-ttu-id="be40b-130">打印队列下一次可用的时间。</span><span class="sxs-lookup"><span data-stu-id="be40b-130">The time when the print queue is next available.</span></span>  
  
- <span data-ttu-id="be40b-131">打印作业下一次可用的时间。</span><span class="sxs-lookup"><span data-stu-id="be40b-131">The time when the print job is next available.</span></span>  
  
 <span data-ttu-id="be40b-132">报告当天的时间时， <xref:System.DateTime.ToShortTimeString%2A> 还会调用方法，因为此方法会取消输出的年、月和日。</span><span class="sxs-lookup"><span data-stu-id="be40b-132">When reporting times of day, the <xref:System.DateTime.ToShortTimeString%2A> method is also called because this method suppresses the years, months, and days from the output.</span></span> <span data-ttu-id="be40b-133">不能将打印队列或打印作业的可用性限制为特定年、月或日。</span><span class="sxs-lookup"><span data-stu-id="be40b-133">You cannot restrict the availability of either a print queue or a print job to particular years, months, or days.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#reportqueueandjobavailability)]
 [!code-csharp[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#reportqueueandjobavailability)]
 [!code-vb[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#reportqueueandjobavailability)]  
  
 <span data-ttu-id="be40b-134">除了传递给它们的类型外， **ReportAvailabilityAtThisTime** 方法的两个重载都是相同的，因此仅 <xref:System.Printing.PrintQueue> 下面提供版本。</span><span class="sxs-lookup"><span data-stu-id="be40b-134">The two overloads of the **ReportAvailabilityAtThisTime** method are identical except for the type passed to them, so only the <xref:System.Printing.PrintQueue> version is presented below.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="be40b-135">除了类型外，方法是相同的，引发了示例不创建泛型方法 **ReportAvailabilityAtThisTime \<T>** 的问题。</span><span class="sxs-lookup"><span data-stu-id="be40b-135">The fact that the methods are identical except for type raises the question of why the sample does not create a generic method **ReportAvailabilityAtThisTime\<T>**.</span></span> <span data-ttu-id="be40b-136">原因在于，这种方法必须被限制为具有该方法所调用的 **StartTimeOfDay** 和 **system.printing.printqueue.untiltimeofday** 属性的类，但泛型方法只能限制为单一类，并且 <xref:System.Printing.PrintQueue> 在继承树中的唯一公共类没有 <xref:System.Printing.PrintSystemJobInfo> 此类 <xref:System.Printing.PrintSystemObject> 属性。</span><span class="sxs-lookup"><span data-stu-id="be40b-136">The reason is that such a method would have to be restricted to a class that has the **StartTimeOfDay** and **UntilTimeOfDay** properties that the method calls, but a generic method can only be restricted to a single class and the only class common to both <xref:System.Printing.PrintQueue> and <xref:System.Printing.PrintSystemJobInfo> in the inheritance tree is <xref:System.Printing.PrintSystemObject> which has no such properties.</span></span>  
  
 <span data-ttu-id="be40b-137">下面的代码示例中 (显示的 **ReportAvailabilityAtThisTime** 方法) 从 <xref:System.Boolean> 将 sentinel 变量初始化为开始 `true` 。</span><span class="sxs-lookup"><span data-stu-id="be40b-137">The **ReportAvailabilityAtThisTime** method (presented in the code example below) begins by initializing a <xref:System.Boolean> sentinel variable to `true`.</span></span> <span data-ttu-id="be40b-138">`false`如果队列不可用，它将重置为。</span><span class="sxs-lookup"><span data-stu-id="be40b-138">It will be reset to `false`, if the queue is not available.</span></span>  
  
 <span data-ttu-id="be40b-139">接下来，该方法将检查 "开始" 和 "结束" 时间是否相同。</span><span class="sxs-lookup"><span data-stu-id="be40b-139">Next, the method checks to see if the start and "until" times are identical.</span></span> <span data-ttu-id="be40b-140">如果是，则该队列始终可用，因此该方法返回 `true` 。</span><span class="sxs-lookup"><span data-stu-id="be40b-140">If they are, the queue is always available, so the method returns `true`.</span></span>  
  
 <span data-ttu-id="be40b-141">如果队列始终不可用，则该方法将使用静态 <xref:System.DateTime.UtcNow%2A> 属性获取当前时间作为 <xref:System.DateTime> 对象。</span><span class="sxs-lookup"><span data-stu-id="be40b-141">If the queue is not available all the time, the method uses the static <xref:System.DateTime.UtcNow%2A> property to get the current time as a <xref:System.DateTime> object.</span></span> <span data-ttu-id="be40b-142"> (我们不需要本地时间 <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> ，因为和 <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> 属性本身是 UTC 时间。 ) </span><span class="sxs-lookup"><span data-stu-id="be40b-142">(We do not need local time because the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties are themselves in UTC time.)</span></span>  
  
 <span data-ttu-id="be40b-143">但是，这两个属性不是 <xref:System.DateTime> 对象。</span><span class="sxs-lookup"><span data-stu-id="be40b-143">However, these two properties are not <xref:System.DateTime> objects.</span></span> <span data-ttu-id="be40b-144">它们将 <xref:System.Int32> 时间表示为 UTC 时间之后的分钟数。</span><span class="sxs-lookup"><span data-stu-id="be40b-144">They are <xref:System.Int32>s expressing the time as the number of minutes-after-UTC-midnight.</span></span> <span data-ttu-id="be40b-145">因此，我们必须将对象转换 <xref:System.DateTime> 为午夜后的分钟数。</span><span class="sxs-lookup"><span data-stu-id="be40b-145">So we do have to convert our <xref:System.DateTime> object to minutes-after-midnight.</span></span> <span data-ttu-id="be40b-146">完成此操作后，该方法只需检查 "现在" 是否在队列的 "开始" 和 "结束" 时间之间，如果 "now" 不在两个时间之间，则将 "sentinel" 设置为 "false"，并返回 sentinel。</span><span class="sxs-lookup"><span data-stu-id="be40b-146">When that is done, the method simply checks to see whether "now" is between the queue's start and "until" times, sets the sentinel to false if "now" is not between the two times, and returns the sentinel.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#PrintQueueStartUntil](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#printqueuestartuntil)]
 [!code-csharp[DiagnoseProblematicPrintJob#PrintQueueStartUntil](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#printqueuestartuntil)]
 [!code-vb[DiagnoseProblematicPrintJob#PrintQueueStartUntil](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#printqueuestartuntil)]  
  
 <span data-ttu-id="be40b-147">下面的代码示例中 (提供的 **ConvertToLocalHumanReadableTime** 方法) 不使用 Microsoft .NET 框架引入的任何方法，因此讨论很简单。</span><span class="sxs-lookup"><span data-stu-id="be40b-147">The **TimeConverter.ConvertToLocalHumanReadableTime** method (presented in the code example below) does not use any methods introduced with Microsoft .NET Framework, so the discussion is brief.</span></span> <span data-ttu-id="be40b-148">方法具有双重转换任务：它必须采用一个整数，表示午夜后的分钟数，并将其转换为可读的时间，并且必须将其转换为本地时间。</span><span class="sxs-lookup"><span data-stu-id="be40b-148">The method has a double conversion task: it must take an integer expressing minutes-after-midnight and convert it to a human-readable time and it must convert this to the local time.</span></span> <span data-ttu-id="be40b-149">它通过首先创建一个 <xref:System.DateTime> 设置为午夜 UTC 的对象来完成此工作，然后使用 <xref:System.DateTime.AddMinutes%2A> 方法来添加已传递给方法的分钟数。</span><span class="sxs-lookup"><span data-stu-id="be40b-149">It accomplishes this by first creating a <xref:System.DateTime> object that is set to midnight UTC and then it uses the <xref:System.DateTime.AddMinutes%2A> method to add the minutes that were passed to the method.</span></span> <span data-ttu-id="be40b-150">这会返回一个新的， <xref:System.DateTime> 表示传递给方法的初始时间。</span><span class="sxs-lookup"><span data-stu-id="be40b-150">This returns a new <xref:System.DateTime> expressing the original time that was passed to the method.</span></span> <span data-ttu-id="be40b-151"><xref:System.DateTime.ToLocalTime%2A>然后，方法将此转换为本地时间。</span><span class="sxs-lookup"><span data-stu-id="be40b-151">The <xref:System.DateTime.ToLocalTime%2A> method then converts this to local time.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#TimeConverter](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#timeconverter)]
 [!code-csharp[DiagnoseProblematicPrintJob#TimeConverter](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#timeconverter)]
 [!code-vb[DiagnoseProblematicPrintJob#TimeConverter](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#timeconverter)]  
  
## <a name="see-also"></a><span data-ttu-id="be40b-152">另请参阅</span><span class="sxs-lookup"><span data-stu-id="be40b-152">See also</span></span>

- <xref:System.DateTime>
- <xref:System.Printing.PrintSystemJobInfo>
- <xref:System.Printing.PrintQueue>
- [<span data-ttu-id="be40b-153">WPF 中的文档</span><span class="sxs-lookup"><span data-stu-id="be40b-153">Documents in WPF</span></span>](documents-in-wpf.md)
- [<span data-ttu-id="be40b-154">打印概述</span><span class="sxs-lookup"><span data-stu-id="be40b-154">Printing Overview</span></span>](printing-overview.md)
