---
title: 资源和代码
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- keys [WPF], using objects as
- resources [WPF], accessing from procedural code
- procedural code [WPF], creating resources with
- procedural code [WPF], accessing resources from
- resources [WPF], creating with procedural code
ms.assetid: c1cfcddb-e39c-41c8-a7f3-60984914dfae
ms.openlocfilehash: e415bb5e79632efe45fc200c04ec3f14197621d7
ms.sourcegitcommit: 069786bcadbf9cd931d7dc3d892262cd852d2ffb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/19/2021
ms.locfileid: "104664998"
---
# <a name="resources-and-code"></a><span data-ttu-id="42ff2-102">资源和代码</span><span class="sxs-lookup"><span data-stu-id="42ff2-102">Resources and Code</span></span>
<span data-ttu-id="42ff2-103">本概述主要介绍如何使用代码（而非 [!INCLUDE[TLA#tla_xaml](../../../includes/tlasharptla-xaml-md.md)] 语法）来访问或创建 [!INCLUDE[TLA#tla_winclient](../../../includes/tlasharptla-winclient-md.md)] 资源。</span><span class="sxs-lookup"><span data-stu-id="42ff2-103">This overview concentrates on how [!INCLUDE[TLA#tla_winclient](../../../includes/tlasharptla-winclient-md.md)] resources can be accessed or created using  code rather than [!INCLUDE[TLA#tla_xaml](../../../includes/tlasharptla-xaml-md.md)] syntax.</span></span> <span data-ttu-id="42ff2-104">有关常规资源用法以及 [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] 语法角度的资源的详细信息，请参阅 [XAML 资源](/dotnet/desktop-wpf/fundamentals/xaml-resources-define)。</span><span class="sxs-lookup"><span data-stu-id="42ff2-104">For more information on general resource usage and resources from a [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] syntax perspective, see [XAML Resources](/dotnet/desktop-wpf/fundamentals/xaml-resources-define).</span></span>  

<a name="accessing"></a>
## <a name="accessing-resources-from-code"></a><span data-ttu-id="42ff2-105">从代码访问资源</span><span class="sxs-lookup"><span data-stu-id="42ff2-105">Accessing Resources from Code</span></span>  
 <span data-ttu-id="42ff2-106">用于识别通过 [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] 定义的资源的键也用于检索特定资源（如果你在代码中请求此资源）。</span><span class="sxs-lookup"><span data-stu-id="42ff2-106">The keys that identify resources if they are defined through [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] are also used to retrieve specific resources if you request the resource in code.</span></span> <span data-ttu-id="42ff2-107">若要从代码中检索资源，最简单的方法是 <xref:System.Windows.FrameworkElement.FindResource%2A> <xref:System.Windows.FrameworkElement.TryFindResource%2A> 从应用程序中的框架级别对象调用或方法。</span><span class="sxs-lookup"><span data-stu-id="42ff2-107">The simplest way to retrieve a resource from code is to call either the <xref:System.Windows.FrameworkElement.FindResource%2A> or the <xref:System.Windows.FrameworkElement.TryFindResource%2A> method from framework-level objects in your application.</span></span> <span data-ttu-id="42ff2-108">这两个方法之间的行为差异在于当未找到所请求的键时所发生的情况。</span><span class="sxs-lookup"><span data-stu-id="42ff2-108">The behavioral difference between these methods is what happens if the requested key is not found.</span></span> <span data-ttu-id="42ff2-109"><xref:System.Windows.FrameworkElement.FindResource%2A> 引发异常; <xref:System.Windows.FrameworkElement.TryFindResource%2A> 不会引发异常，而会返回 `null` 。</span><span class="sxs-lookup"><span data-stu-id="42ff2-109"><xref:System.Windows.FrameworkElement.FindResource%2A> raises an exception; <xref:System.Windows.FrameworkElement.TryFindResource%2A> will not raise an exception but returns `null`.</span></span> <span data-ttu-id="42ff2-110">每个方法都将资源键作为一个输入参数，并返回一个松散类型化对象。</span><span class="sxs-lookup"><span data-stu-id="42ff2-110">Each method takes the resource key as an input parameter, and returns a loosely typed object.</span></span> <span data-ttu-id="42ff2-111">资源键通常是字符串，但有时也用作非字符串；有关详细信息，请参阅[将对象用作键](#objectaskey)部分。</span><span class="sxs-lookup"><span data-stu-id="42ff2-111">Typically, a resource key is a string, but there are occasional nonstring usages; see the [Using Objects as Keys](#objectaskey) section for details.</span></span> <span data-ttu-id="42ff2-112">通常应将返回的对象强制转换为请求资源时设置的属性所要求的类型。</span><span class="sxs-lookup"><span data-stu-id="42ff2-112">Typically you would cast the returned object to the type required by the property that you are setting when requesting the resource.</span></span> <span data-ttu-id="42ff2-113">代码资源解析的查找逻辑与动态资源引用 [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] 情况相同。</span><span class="sxs-lookup"><span data-stu-id="42ff2-113">The lookup logic for code resource resolution is the same as the dynamic resource reference [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] case.</span></span> <span data-ttu-id="42ff2-114">对资源的搜索从调用元素开始，然后继续搜索逻辑树中的后续父元素。</span><span class="sxs-lookup"><span data-stu-id="42ff2-114">The search for resources starts from the calling element, then continues to successive parent elements in the logical tree.</span></span> <span data-ttu-id="42ff2-115">如果必要，将继续查找应用程序资源、主题以及系统资源。</span><span class="sxs-lookup"><span data-stu-id="42ff2-115">The lookup continues onwards into application resources, themes, and system resources if necessary.</span></span> <span data-ttu-id="42ff2-116">资源的代码请求将正确地说明资源字典（可能排在从 [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] 加载的资源字典之后）中的运行时更改，也将说明实时系统资源更改。</span><span class="sxs-lookup"><span data-stu-id="42ff2-116">A code request for a resource will properly account for runtime changes in resource dictionaries that might have been made subsequent to that resource dictionary being loaded from [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)], and also for realtime system resource changes.</span></span>  
  
 <span data-ttu-id="42ff2-117">下面是一个简短的代码示例，它按键查找资源，并使用返回的值来设置作为 <xref:System.Windows.Controls.Primitives.ButtonBase.Click> 事件处理程序实现的属性。</span><span class="sxs-lookup"><span data-stu-id="42ff2-117">The following is a brief code example that finds a resource by key and uses the returned value to set a property, implemented as a <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event handler.</span></span>  
  
 [!code-csharp[PropertiesOvwSupport#ResourceProceduralGet](~/samples/snippets/csharp/VS_Snippets_Wpf/PropertiesOvwSupport/CSharp/page3.xaml.cs#resourceproceduralget)]
 [!code-vb[PropertiesOvwSupport#ResourceProceduralGet](~/samples/snippets/visualbasic/VS_Snippets_Wpf/PropertiesOvwSupport/visualbasic/page3.xaml.vb#resourceproceduralget)]  
  
 <span data-ttu-id="42ff2-118">分配资源引用的一种替代方法是 <xref:System.Windows.FrameworkElement.SetResourceReference%2A> 。</span><span class="sxs-lookup"><span data-stu-id="42ff2-118">An alternative method for assigning a resource reference is <xref:System.Windows.FrameworkElement.SetResourceReference%2A>.</span></span> <span data-ttu-id="42ff2-119">该方法采用两个参数：资源的键，以及特定依赖属性（应向其分配资源值的元素实例上的依赖属性）的标识符。</span><span class="sxs-lookup"><span data-stu-id="42ff2-119">This method takes two parameters: the key of the resource, and the identifier for a particular dependency property that is present on the element instance to which the resource value should be assigned.</span></span> <span data-ttu-id="42ff2-120">就功能而言，此方法是相同的，且具有无需强制转换任何返回值的优点。</span><span class="sxs-lookup"><span data-stu-id="42ff2-120">Functionally, this method is the same and has the advantage of not requiring any casting of return values.</span></span>  
  
 <span data-ttu-id="42ff2-121">以编程方式访问资源的另一种方法是以 <xref:System.Windows.FrameworkElement.Resources%2A> 字典形式访问属性的内容。</span><span class="sxs-lookup"><span data-stu-id="42ff2-121">Still another way to access resources programmatically is to access the contents of the <xref:System.Windows.FrameworkElement.Resources%2A> property as a dictionary.</span></span> <span data-ttu-id="42ff2-122">通过访问该属性包含的字典，还可以向现有集合添加新资源、检查集合中是否已经存在给定的键名称以及执行其他字典/集合操作。</span><span class="sxs-lookup"><span data-stu-id="42ff2-122">Accessing the dictionary contained by this property is also how you can add new resources to existing collections, check to see if a given key name is already taken in the collection, and other dictionary/collection operations.</span></span> <span data-ttu-id="42ff2-123">如果 [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] 完全在代码中编写应用程序，则还可以在代码中创建整个集合，为其分配键，然后将完成的集合分配给已 <xref:System.Windows.FrameworkElement.Resources%2A> 建立的元素的属性。</span><span class="sxs-lookup"><span data-stu-id="42ff2-123">If you are writing a [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] application entirely in code, you can also create the entire collection in code, assign keys to it, and then assign the finished collection to the <xref:System.Windows.FrameworkElement.Resources%2A> property of an established element.</span></span> <span data-ttu-id="42ff2-124">这将在下一部分介绍。</span><span class="sxs-lookup"><span data-stu-id="42ff2-124">This will be described in the next section.</span></span>  
  
 <span data-ttu-id="42ff2-125">您可以 <xref:System.Windows.FrameworkElement.Resources%2A> 使用特定键作为索引在任何给定集合中进行索引，但您应注意，以这种方式访问资源不遵循资源解析的正常运行时规则。</span><span class="sxs-lookup"><span data-stu-id="42ff2-125">You can index within any given <xref:System.Windows.FrameworkElement.Resources%2A> collection, using a specific key as the index, but you should be aware that accessing the resource in this way does not follow the normal runtime rules of resource resolution.</span></span> <span data-ttu-id="42ff2-126">你访问的仅是该特定集合。</span><span class="sxs-lookup"><span data-stu-id="42ff2-126">You are only accessing that particular collection.</span></span> <span data-ttu-id="42ff2-127">如果在请求的键处未找到有效的对象，则资源查找将不会遍历范围直至根或应用程序。</span><span class="sxs-lookup"><span data-stu-id="42ff2-127">Resource lookup will not be traversing the scope to the root or the application if no valid object was found at the requested key.</span></span> <span data-ttu-id="42ff2-128">但是，在某些情况下，正因为对键的搜索范围进行了更多的约束，才使得此方法在性能上具有优势。</span><span class="sxs-lookup"><span data-stu-id="42ff2-128">However, this approach may have performance advantages in some cases precisely because the scope of the search for the key is more constrained.</span></span> <span data-ttu-id="42ff2-129"><xref:System.Windows.ResourceDictionary>有关如何直接使用资源字典的详细信息，请参见类。</span><span class="sxs-lookup"><span data-stu-id="42ff2-129">See the <xref:System.Windows.ResourceDictionary> class for more details on how to work with the resource dictionary directly.</span></span>  
  
<a name="creating"></a>
## <a name="creating-resources-with-code"></a><span data-ttu-id="42ff2-130">使用代码创建资源</span><span class="sxs-lookup"><span data-stu-id="42ff2-130">Creating Resources with Code</span></span>  
 <span data-ttu-id="42ff2-131">如果要通过代码方式创建整个 [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] 应用程序，可能也需要通过代码方式创建该应用程序中的任何资源。</span><span class="sxs-lookup"><span data-stu-id="42ff2-131">If you want to create an entire [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] application in code, you might also want to create any resources in that application in code.</span></span> <span data-ttu-id="42ff2-132">若要实现此目的，请创建一个新的 <xref:System.Windows.ResourceDictionary> 实例，然后使用对的连续调用将所有资源添加到字典中 <xref:System.Windows.ResourceDictionary.Add%2A?displayProperty=nameWithType> 。</span><span class="sxs-lookup"><span data-stu-id="42ff2-132">To achieve this, create a new <xref:System.Windows.ResourceDictionary> instance, and then add all the resources to the dictionary using successive calls to <xref:System.Windows.ResourceDictionary.Add%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="42ff2-133">然后，使用 <xref:System.Windows.ResourceDictionary> 创建的来设置 <xref:System.Windows.FrameworkElement.Resources%2A> 页面范围中存在的元素的属性或 <xref:System.Windows.Application.Resources%2A?displayProperty=nameWithType> 。</span><span class="sxs-lookup"><span data-stu-id="42ff2-133">Then, use the <xref:System.Windows.ResourceDictionary> thus created to set the <xref:System.Windows.FrameworkElement.Resources%2A> property on an element that is present in a page scope, or the <xref:System.Windows.Application.Resources%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="42ff2-134">你还可以将 <xref:System.Windows.ResourceDictionary> 用作独立对象，而无需将其添加到元素。</span><span class="sxs-lookup"><span data-stu-id="42ff2-134">You could also maintain the <xref:System.Windows.ResourceDictionary> as a standalone object without adding it to an element.</span></span> <span data-ttu-id="42ff2-135">但是，如果这样做，必须通过项键来访问其中的资源，就好像它是泛型字典一样。</span><span class="sxs-lookup"><span data-stu-id="42ff2-135">However, if you do this, you must access the resources within it by item key, as if it were a generic dictionary.</span></span> <span data-ttu-id="42ff2-136"><xref:System.Windows.ResourceDictionary>未附加到元素属性的不是 `Resources` 元素树的一部分，并且在查找序列中没有可供和相关方法使用的作用域 <xref:System.Windows.FrameworkElement.FindResource%2A> 。</span><span class="sxs-lookup"><span data-stu-id="42ff2-136">A <xref:System.Windows.ResourceDictionary> that is not attached to an element `Resources` property would not  exist as part of the element tree and has no scope in a lookup sequence that can be used by <xref:System.Windows.FrameworkElement.FindResource%2A> and related methods.</span></span>  
  
<a name="objectaskey"></a>
## <a name="using-objects-as-keys"></a><span data-ttu-id="42ff2-137">将对象用作键</span><span class="sxs-lookup"><span data-stu-id="42ff2-137">Using Objects as Keys</span></span>  
 <span data-ttu-id="42ff2-138">大多数资源用法都会将资源的键设置为字符串。</span><span class="sxs-lookup"><span data-stu-id="42ff2-138">Most resource usages will set the key of the resource to be a string.</span></span> <span data-ttu-id="42ff2-139">但是，各个 [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] 功能都特意不使用字符串类型来指定键，而是将此参数设置为对象。</span><span class="sxs-lookup"><span data-stu-id="42ff2-139">However, various [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] features deliberately do not use a string type to specify keys, instead this parameter is an object.</span></span> <span data-ttu-id="42ff2-140">[!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] 样式和主题支持使用按对象对资源进行键控的功能。</span><span class="sxs-lookup"><span data-stu-id="42ff2-140">The capability of having the resource be keyed by an object is used by the [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] style and theming support.</span></span> <span data-ttu-id="42ff2-141">如果主题中的样式是其他非样式控件的默认样式，则这些样式将由 <xref:System.Type> 其应用于的控件的进行键控。</span><span class="sxs-lookup"><span data-stu-id="42ff2-141">The styles in themes which become the default style for an otherwise non-styled control are each keyed by the <xref:System.Type> of the control that they should apply to.</span></span> <span data-ttu-id="42ff2-142">按类型进行键控提供了一种可靠的查找机制，该机制作用于每个控件类型的默认实例，即使派生类型不具有默认样式，也可以通过反射检测到类型，并将类型用于设置派生类的样式。</span><span class="sxs-lookup"><span data-stu-id="42ff2-142">Being keyed by type provides a reliable lookup mechanism that works on default instances of each control type, and type can be detected by reflection and used for styling derived classes even though the derived type otherwise has no default style.</span></span> <span data-ttu-id="42ff2-143">可以 <xref:System.Type> [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] 通过使用 [x:Type 标记扩展](/dotnet/desktop-wpf/xaml-services/xtype-markup-extension)为中定义的资源指定密钥。</span><span class="sxs-lookup"><span data-stu-id="42ff2-143">You can specify a <xref:System.Type> key for a resource defined in [!INCLUDE[TLA2#tla_xaml](../../../includes/tla2sharptla-xaml-md.md)] by using the [x:Type Markup Extension](/dotnet/desktop-wpf/xaml-services/xtype-markup-extension).</span></span> <span data-ttu-id="42ff2-144">对于支持 [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] 功能的其他非字符串键用法，也存在类似扩展，如 [ComponentResourceKey 标记扩展](componentresourcekey-markup-extension.md)。</span><span class="sxs-lookup"><span data-stu-id="42ff2-144">Similar extensions exist for other nonstring key usages that support [!INCLUDE[TLA2#tla_winclient](../../../includes/tla2sharptla-winclient-md.md)] features, such as [ComponentResourceKey Markup Extension](componentresourcekey-markup-extension.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="42ff2-145">请参阅</span><span class="sxs-lookup"><span data-stu-id="42ff2-145">See also</span></span>

- [<span data-ttu-id="42ff2-146">XAML 资源</span><span class="sxs-lookup"><span data-stu-id="42ff2-146">XAML Resources</span></span>](/dotnet/desktop-wpf/fundamentals/xaml-resources-define)
- [<span data-ttu-id="42ff2-147">样式设置和模板化</span><span class="sxs-lookup"><span data-stu-id="42ff2-147">Styling and Templating</span></span>](/dotnet/desktop-wpf/fundamentals/styles-templates-overview)
