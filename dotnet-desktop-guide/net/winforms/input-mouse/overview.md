---
title: 鼠标输入概述
description: 了解适用于 .NET 的 Windows 窗体中鼠标输入的工作原理。 鼠标事件由窗体和控件引发，表示鼠标的位置和按钮状态。
ms.date: 10/26/2020
ms.topic: overview
helpviewer_keywords:
- Windows Forms, mouse input
- mouse [Windows Forms], input
ms.openlocfilehash: 3e85305796d724d9acdbcd2e7cb86e748c30b783
ms.sourcegitcommit: 9f6df084c53a3da0ea657ed0d708a72213683084
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/09/2020
ms.locfileid: "96941940"
---
# <a name="overview-of-using-the-mouse-windows-forms-net"></a><span data-ttu-id="077a2-104">使用鼠标的概述（Windows 窗体 .NET）</span><span class="sxs-lookup"><span data-stu-id="077a2-104">Overview of using the mouse (Windows Forms .NET)</span></span>

<span data-ttu-id="077a2-105">接收和处理鼠标输入是每个 Windows 应用程序的重要组成部分。</span><span class="sxs-lookup"><span data-stu-id="077a2-105">Receiving and handling mouse input is an important part of every Windows application.</span></span> <span data-ttu-id="077a2-106">你可以处理鼠标事件以在应用程序中执行操作，或使用鼠标位置信息执行命中测试或其他操作。</span><span class="sxs-lookup"><span data-stu-id="077a2-106">You can handle mouse events to carry out an action in your application, or use mouse location information to perform hit testing or other actions.</span></span> <span data-ttu-id="077a2-107">此外，你还可更改应用程序中的控件处理鼠标输入的方式。</span><span class="sxs-lookup"><span data-stu-id="077a2-107">Also, you can change the way the controls in your application handle mouse input.</span></span> <span data-ttu-id="077a2-108">本文将详细介绍这些鼠标事件，以及如何获取和更改鼠标的系统设置。</span><span class="sxs-lookup"><span data-stu-id="077a2-108">This article describes these mouse events in detail, and how to obtain and change system settings for the mouse.</span></span>

[!INCLUDE [desktop guide under construction](../../includes/desktop-guide-preview-note.md)]

<span data-ttu-id="077a2-109">在 Windows 窗体中，用户输入以 [Windows 消息](/windows/win32/winmsg/about-messages-and-message-queues)的形式发送到应用程序。</span><span class="sxs-lookup"><span data-stu-id="077a2-109">In Windows Forms, user input is sent to applications in the form of [Windows messages](/windows/win32/winmsg/about-messages-and-message-queues).</span></span> <span data-ttu-id="077a2-110">一系列可重写的方法在应用程序、窗体和控件级别处理这些消息。</span><span class="sxs-lookup"><span data-stu-id="077a2-110">A series of overridable methods process these messages at the application, form, and control level.</span></span> <span data-ttu-id="077a2-111">当这些方法接收鼠标消息时，它们会引发可处理的事件以获取有关鼠标输入的信息。</span><span class="sxs-lookup"><span data-stu-id="077a2-111">When these methods receive mouse messages, they raise events that can be handled to get information about the mouse input.</span></span> <span data-ttu-id="077a2-112">在许多情况下，Windows 窗体应用程序只需通过处理这些事件即可处理所有用户输入。</span><span class="sxs-lookup"><span data-stu-id="077a2-112">In many cases, Windows Forms applications can process all user input simply by handling these events.</span></span> <span data-ttu-id="077a2-113">在其他情况下，应用程序可能会重写处理消息的方法之一，以便在应用程序、窗体或控件接收特定消息之前截获该消息。</span><span class="sxs-lookup"><span data-stu-id="077a2-113">In other cases, an application may override one of the methods that process messages to intercept a particular message before it's received by the application, form, or control.</span></span>

## <a name="mouse-events"></a><span data-ttu-id="077a2-114">鼠标事件</span><span class="sxs-lookup"><span data-stu-id="077a2-114">Mouse Events</span></span>

<span data-ttu-id="077a2-115">所有 Windows 窗体控件都将继承与鼠标和键盘输入相关的一组事件。</span><span class="sxs-lookup"><span data-stu-id="077a2-115">All Windows Forms controls inherit a set of events related to mouse and keyboard input.</span></span> <span data-ttu-id="077a2-116">例如，控件可以处理 <xref:System.Windows.Forms.Control.MouseClick> 事件以确定鼠标单击的位置。</span><span class="sxs-lookup"><span data-stu-id="077a2-116">For example, a control can handle the <xref:System.Windows.Forms.Control.MouseClick> event to determine the location of a mouse click.</span></span> <span data-ttu-id="077a2-117">有关鼠标事件的详细信息，请参阅[使用鼠标事件](events.md)。</span><span class="sxs-lookup"><span data-stu-id="077a2-117">For more information on the mouse events, see [Using mouse events](events.md).</span></span>

## <a name="mouse-location-and-hit-testing"></a><span data-ttu-id="077a2-118">鼠标位置和命中测试</span><span class="sxs-lookup"><span data-stu-id="077a2-118">Mouse location and hit-testing</span></span>

<span data-ttu-id="077a2-119">当用户移动鼠标时，操作系统将移动鼠标指针。</span><span class="sxs-lookup"><span data-stu-id="077a2-119">When the user moves the mouse, the operating system moves the mouse pointer.</span></span> <span data-ttu-id="077a2-120">鼠标指针包含一个称为“热点”的像素，操作系统会跟踪该像素并将其识别为指针的位置。</span><span class="sxs-lookup"><span data-stu-id="077a2-120">The mouse pointer contains a single pixel, called the hot spot, which the operating system tracks and recognizes as the position of the pointer.</span></span> <span data-ttu-id="077a2-121">当用户移动鼠标或按下鼠标按钮时，包含 <xref:System.Windows.Forms.Cursor.HotSpot%2A> 的 <xref:System.Windows.Forms.Control> 将引发相应的鼠标事件。</span><span class="sxs-lookup"><span data-stu-id="077a2-121">When the user moves the mouse or presses a mouse button, the <xref:System.Windows.Forms.Control> that contains the <xref:System.Windows.Forms.Cursor.HotSpot%2A> raises the appropriate mouse event.</span></span>

<span data-ttu-id="077a2-122">可以在处理鼠标事件时使用 <xref:System.Windows.Forms.MouseEventArgs> 的 <xref:System.Windows.Forms.MouseEventArgs.Location%2A> 属性获取当前鼠标位置，也可使用 <xref:System.Windows.Forms.Cursor> 类的 <xref:System.Windows.Forms.Cursor.Position%2A> 属性获取当前鼠标位置。</span><span class="sxs-lookup"><span data-stu-id="077a2-122">You can obtain the current mouse position with the <xref:System.Windows.Forms.MouseEventArgs.Location%2A> property of the <xref:System.Windows.Forms.MouseEventArgs> when handling a mouse event or by using the <xref:System.Windows.Forms.Cursor.Position%2A> property of the <xref:System.Windows.Forms.Cursor> class.</span></span> <span data-ttu-id="077a2-123">然后可使用鼠标位置信息来执行命中测试，然后根据鼠标的位置执行操作。</span><span class="sxs-lookup"><span data-stu-id="077a2-123">You can then use mouse location information to carry out hit-testing, and then perform an action based on the location of the mouse.</span></span> <span data-ttu-id="077a2-124">命中测试功能内置于 Windows 窗体中的若干控件，如 <xref:System.Windows.Forms.ListView>、<xref:System.Windows.Forms.TreeView>、<xref:System.Windows.Forms.MonthCalendar> 和 <xref:System.Windows.Forms.DataGridView> 控件。</span><span class="sxs-lookup"><span data-stu-id="077a2-124">Hit-testing capability is built in to several controls in Windows Forms such as the <xref:System.Windows.Forms.ListView>, <xref:System.Windows.Forms.TreeView>, <xref:System.Windows.Forms.MonthCalendar> and <xref:System.Windows.Forms.DataGridView> controls.</span></span>

<span data-ttu-id="077a2-125">与相应的鼠标事件（例如 <xref:System.Windows.Forms.Control.MouseHover>）一起使用时，命中测试在确定应用程序应何时执行特定操作时非常有用。</span><span class="sxs-lookup"><span data-stu-id="077a2-125">Used with the appropriate mouse event, <xref:System.Windows.Forms.Control.MouseHover> for example, hit-testing is very useful for determining when your application should do a specific action.</span></span>

## <a name="changing-mouse-input-settings"></a><span data-ttu-id="077a2-126">更改鼠标输入设置</span><span class="sxs-lookup"><span data-stu-id="077a2-126">Changing mouse input settings</span></span>

<span data-ttu-id="077a2-127">可通过从控件派生并使用 <xref:System.Windows.Forms.Control.GetStyle%2A> 和 <xref:System.Windows.Forms.Control.SetStyle%2A> 方法，检测并更改控件处理鼠标输入的方式。</span><span class="sxs-lookup"><span data-stu-id="077a2-127">You can detect and change the way a control handles mouse input by deriving from the control and using the <xref:System.Windows.Forms.Control.GetStyle%2A> and <xref:System.Windows.Forms.Control.SetStyle%2A> methods.</span></span> <span data-ttu-id="077a2-128"><xref:System.Windows.Forms.Control.SetStyle%2A> 方法使用 <xref:System.Windows.Forms.ControlStyles> 值的按位组合来确定控件是否将具有标准单击、双击行为，或控件是否将处理自己的鼠标处理。</span><span class="sxs-lookup"><span data-stu-id="077a2-128">The <xref:System.Windows.Forms.Control.SetStyle%2A> method takes a bitwise combination of <xref:System.Windows.Forms.ControlStyles> values to determine whether the control will have standard click, double-click behavior, or if the control will handle its own mouse processing.</span></span> <span data-ttu-id="077a2-129">此外，<xref:System.Windows.Forms.SystemInformation> 类还包括描述鼠标功能以及指定鼠标与操作系统交互方式的属性。</span><span class="sxs-lookup"><span data-stu-id="077a2-129">Also, the <xref:System.Windows.Forms.SystemInformation> class includes properties that describe the capabilities of the mouse and specify how the mouse interacts with the operating system.</span></span> <span data-ttu-id="077a2-130">下表对这些属性进行了总结。</span><span class="sxs-lookup"><span data-stu-id="077a2-130">The following table summarizes these properties.</span></span>

| <span data-ttu-id="077a2-131">属性</span><span class="sxs-lookup"><span data-stu-id="077a2-131">Property</span></span>                                                               | <span data-ttu-id="077a2-132">描述</span><span class="sxs-lookup"><span data-stu-id="077a2-132">Description</span></span>                                                                                                                                                            |
|------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <xref:System.Windows.Forms.SystemInformation.DoubleClickSize%2A>       | <span data-ttu-id="077a2-133">获取如下区域的尺寸（以像素为单位）：用户必须在此区域内单击两次，操作系统才将这两次单击视为一次双击。</span><span class="sxs-lookup"><span data-stu-id="077a2-133">Gets the dimensions, in pixels, of the area in which the user must click twice for the operating system to consider the two clicks a double-click.</span></span>                     |
| <xref:System.Windows.Forms.SystemInformation.DoubleClickTime%2A>       | <span data-ttu-id="077a2-134">获取要将鼠标操作视为双击的第一次单击与第二次单击之间可以经过的最大毫秒数。</span><span class="sxs-lookup"><span data-stu-id="077a2-134">Gets the maximum number of milliseconds that can elapse between a first click and a second click for the mouse action to be considered a double-click.</span></span> |
| <xref:System.Windows.Forms.SystemInformation.MouseButtons%2A>          | <span data-ttu-id="077a2-135">获取鼠标上的按钮数。</span><span class="sxs-lookup"><span data-stu-id="077a2-135">Gets the number of buttons on the mouse.</span></span>                                                                                                                               |
| <xref:System.Windows.Forms.SystemInformation.MouseButtonsSwapped%2A>   | <span data-ttu-id="077a2-136">获取一个值，该值指示是否已交换鼠标左右按钮的功能。</span><span class="sxs-lookup"><span data-stu-id="077a2-136">Gets a value indicating whether the functions of the left and right mouse buttons have been swapped.</span></span>                                                                   |
| <xref:System.Windows.Forms.SystemInformation.MouseHoverSize%2A>        | <span data-ttu-id="077a2-137">获取特定矩形的尺寸（以像素为单位），鼠标指针必须在该矩形范围内停留达到鼠标悬停时间后，才会生成鼠标悬停消息。</span><span class="sxs-lookup"><span data-stu-id="077a2-137">Gets the dimensions, in pixels, of the rectangle within which the mouse pointer has to stay for the mouse hover time before a mouse hover message is generated.</span></span>        |
| <xref:System.Windows.Forms.SystemInformation.MouseHoverTime%2A>        | <span data-ttu-id="077a2-138">获取一个以毫秒为单位的时间，鼠标指针必须在悬停矩形中停留该时间后，才会生成鼠标悬停消息。</span><span class="sxs-lookup"><span data-stu-id="077a2-138">Gets the time, in milliseconds, that the mouse pointer has to stay in the hover rectangle before a mouse hover message is generated.</span></span>                                   |
| <xref:System.Windows.Forms.SystemInformation.MousePresent%2A>          | <span data-ttu-id="077a2-139">获取一个值，该值指示鼠标是否已安装。</span><span class="sxs-lookup"><span data-stu-id="077a2-139">Gets a value indicating whether a mouse is installed.</span></span>                                                                                                                  |
| <xref:System.Windows.Forms.SystemInformation.MouseSpeed%2A>            | <span data-ttu-id="077a2-140">获取一个值，该值指示当前鼠标速度，范围为 1 至 20。</span><span class="sxs-lookup"><span data-stu-id="077a2-140">Gets a value indicating the current mouse speed, from 1 to 20.</span></span>                                                                                                         |
| <xref:System.Windows.Forms.SystemInformation.MouseWheelPresent%2A>     | <span data-ttu-id="077a2-141">获取一个值，该值指示是否安装了带有鼠标轮的鼠标。</span><span class="sxs-lookup"><span data-stu-id="077a2-141">Gets a value indicating whether a mouse with a mouse wheel is installed.</span></span>                                                                                               |
| <xref:System.Windows.Forms.SystemInformation.MouseWheelScrollDelta%2A> | <span data-ttu-id="077a2-142">获取单次鼠标轮旋转增量的增量值。</span><span class="sxs-lookup"><span data-stu-id="077a2-142">Gets the amount of the delta value of the increment of a single mouse wheel rotation.</span></span>                                                                                  |
| <xref:System.Windows.Forms.SystemInformation.MouseWheelScrollLines%2A> | <span data-ttu-id="077a2-143">获取滚动鼠标轮时所滚动过的行数。</span><span class="sxs-lookup"><span data-stu-id="077a2-143">Gets the number of lines to scroll when the mouse wheel is rotated.</span></span>                                                                                                    |

## <a name="methods-that-process-user-input-messages"></a><span data-ttu-id="077a2-144">处理用户输入消息的方法</span><span class="sxs-lookup"><span data-stu-id="077a2-144">Methods that process user input messages</span></span>

<span data-ttu-id="077a2-145">窗体和控件可以访问 <xref:System.Windows.Forms.IMessageFilter> 接口和一组可重写的方法，这些方法可在消息队列中的不同位置处理 Windows 消息。</span><span class="sxs-lookup"><span data-stu-id="077a2-145">Forms and controls have access to the <xref:System.Windows.Forms.IMessageFilter> interface and a set of overridable methods that process Windows messages at different points in the message queue.</span></span> <span data-ttu-id="077a2-146">这些方法都有 <xref:System.Windows.Forms.Message> 参数，该参数用于封装 Windows 消息的低级别详细信息。</span><span class="sxs-lookup"><span data-stu-id="077a2-146">These methods all have a <xref:System.Windows.Forms.Message> parameter, which encapsulates the low-level details of Windows messages.</span></span> <span data-ttu-id="077a2-147">可以实现或重写这些方法来检查消息，然后使用此消息或将其传递给消息队列中的下一个使用者。</span><span class="sxs-lookup"><span data-stu-id="077a2-147">You can implement or override these methods to examine the message and then either consume the message or pass it on to the next consumer in the message queue.</span></span> <span data-ttu-id="077a2-148">下表显示用于处理 Windows 窗体中所有 Windows 消息的方法。</span><span class="sxs-lookup"><span data-stu-id="077a2-148">The following table presents the methods that process all Windows messages in Windows Forms.</span></span>

| <span data-ttu-id="077a2-149">方法</span><span class="sxs-lookup"><span data-stu-id="077a2-149">Method</span></span>     | <span data-ttu-id="077a2-150">说明</span><span class="sxs-lookup"><span data-stu-id="077a2-150">Notes</span></span> |
|------------|-----------|
| <xref:System.Windows.Forms.IMessageFilter.PreFilterMessage%2A> | <span data-ttu-id="077a2-151">此方法在应用程序级别截获排队的（也称为已发布的）Windows 消息。</span><span class="sxs-lookup"><span data-stu-id="077a2-151">This method intercepts queued (also known as posted) Windows messages at the application level.</span></span>|
| <xref:System.Windows.Forms.Control.PreProcessMessage%2A>       | <span data-ttu-id="077a2-152">此方法在 Windows 消息经过处理之前，在窗体和控件级别截获这些消息。</span><span class="sxs-lookup"><span data-stu-id="077a2-152">This method intercepts Windows messages at the form and control level before they have been processed.</span></span>|
| <xref:System.Windows.Forms.Control.WndProc%2A>                 | <span data-ttu-id="077a2-153">此方法在窗体和控件级别处理 Windows 消息。</span><span class="sxs-lookup"><span data-stu-id="077a2-153">This method processes Windows messages at the form and control level.</span></span>|
| <xref:System.Windows.Forms.Control.DefWndProc%2A>              | <span data-ttu-id="077a2-154">此方法在窗体和控件级别执行 Windows 消息的默认处理。</span><span class="sxs-lookup"><span data-stu-id="077a2-154">This method performs the default processing of Windows messages at the form and control level.</span></span> <span data-ttu-id="077a2-155">这提供了窗口的最小功能。</span><span class="sxs-lookup"><span data-stu-id="077a2-155">This provides the minimal functionality of a window.</span></span>|
| <xref:System.Windows.Forms.Control.OnNotifyMessage%2A>         | <span data-ttu-id="077a2-156">此方法在消息经过处理之后，在窗体和控件级别截获这些消息。</span><span class="sxs-lookup"><span data-stu-id="077a2-156">This method intercepts messages at the form and control level, after they've been processed.</span></span> <span data-ttu-id="077a2-157">必须设置 <xref:System.Windows.Forms.ControlStyles.EnableNotifyMessage> 样式位才能调用此方法。</span><span class="sxs-lookup"><span data-stu-id="077a2-157">The <xref:System.Windows.Forms.ControlStyles.EnableNotifyMessage> style bit must be set for this method to be called.</span></span>|

## <a name="see-also"></a><span data-ttu-id="077a2-158">另请参阅</span><span class="sxs-lookup"><span data-stu-id="077a2-158">See also</span></span>

- [<span data-ttu-id="077a2-159">使用鼠标事件（Windows 窗体 .NET）</span><span class="sxs-lookup"><span data-stu-id="077a2-159">Using mouse events (Windows Forms .NET)</span></span>](events.md)
- [<span data-ttu-id="077a2-160">拖放鼠标行为概述（Windows 窗体 .NET）</span><span class="sxs-lookup"><span data-stu-id="077a2-160">Drag-and-drop mouse behavior overview (Windows Forms .NET)</span></span>](drag-and-drop.md)
- [<span data-ttu-id="077a2-161">管理鼠标指针（Windows 窗体 .NET）</span><span class="sxs-lookup"><span data-stu-id="077a2-161">Manage mouse pointers (Windows Forms .NET)</span></span>](how-to-manage-cursor-pointer.md)
