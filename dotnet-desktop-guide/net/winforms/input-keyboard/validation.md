---
title: 用户输入验证
description: 了解使用 Windows 窗体验证应用程序中的用户输入的多种方法。
ms.date: 10/26/2020
ms.topic: overview
helpviewer_keywords:
- Windows Forms, validating user input
- validation [Windows Forms], Windows Forms user input
- user input [Windows Forms], validating in Windows Forms
- validating user input [Windows Forms], Windows Forms
ms.openlocfilehash: 16db8a1048c5f342f942f88a91a764d6b2a57f35
ms.sourcegitcommit: 9f6df084c53a3da0ea657ed0d708a72213683084
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/09/2020
ms.locfileid: "96941905"
---
# <a name="overview-of-how-to-validate-user-input-windows-forms-net"></a><span data-ttu-id="d8d3a-103">如何验证用户输入（Windows 窗体 .NET）概述</span><span class="sxs-lookup"><span data-stu-id="d8d3a-103">Overview of how to validate user input (Windows Forms .NET)</span></span>

<span data-ttu-id="d8d3a-104">用户在应用程序中输入数据后，建议在应用程序使用数据之前验证数据是否有效。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-104">When users enter data into your application, you may want to verify that the data is valid before your application uses it.</span></span> <span data-ttu-id="d8d3a-105">可以要求某些文本字段的长度不能为零，字段应设置为电话号码格式，或者字符串中不得包含无效字符。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-105">You may require that certain text fields not be zero-length, that a field formatted as a telephone number, or that a string doesn't contain invalid characters.</span></span> <span data-ttu-id="d8d3a-106">Windows 窗体提供了多种方式来验证应用程序中的输入。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-106">Windows Forms provides several ways for you to validate input in your application.</span></span>

[!INCLUDE [desktop guide under construction](../../includes/desktop-guide-preview-note.md)]

## <a name="maskedtextbox-control"></a><span data-ttu-id="d8d3a-107">MaskedTextBox 控件</span><span class="sxs-lookup"><span data-stu-id="d8d3a-107">MaskedTextBox Control</span></span>

<span data-ttu-id="d8d3a-108">如果需要用户以明确定义的格式输入数据，例如电话号码或零件编号，则可以使用 <xref:System.Windows.Forms.MaskedTextBox> 控件以最少的代码快速实现此目的。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-108">If you need to require users to enter data in a well-defined format, such as a telephone number or a part number, you can accomplish this quickly and with minimal code by using the <xref:System.Windows.Forms.MaskedTextBox> control.</span></span> <span data-ttu-id="d8d3a-109">掩码是由掩码语言中的字符组成的字符串，用于指定可在文本框中的任何特定位置输入的字符。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-109">A *mask* is a string made up of characters from a masking language that specifies which characters can be entered at any given position in the text box.</span></span> <span data-ttu-id="d8d3a-110">控件向用户显示一组提示。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-110">The control displays a set of prompts to the user.</span></span> <span data-ttu-id="d8d3a-111">如果用户键入错误条目（例如，用户在需要输入数字时键入字母），则控件将自动拒绝输入。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-111">If the user types an incorrect entry, for example, the user types a letter when a digit is required, the control will automatically reject the input.</span></span>

<span data-ttu-id="d8d3a-112"><xref:System.Windows.Forms.MaskedTextBox> 使用的掩码语言是灵活的。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-112">The masking language that is used by <xref:System.Windows.Forms.MaskedTextBox> is flexible.</span></span> <span data-ttu-id="d8d3a-113">它允许指定必填字符、可选字符、文本字符（例如连字符和括号）、货币字符和日期分隔符。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-113">It allows you to specify required characters, optional characters, literal characters, such as hyphens and parentheses, currency characters, and date separators.</span></span> <span data-ttu-id="d8d3a-114">控件绑定到数据源时也可以正常工作。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-114">The control also works well when bound to a data source.</span></span> <span data-ttu-id="d8d3a-115">可使用数据绑定上的 <xref:System.Windows.Forms.Binding.Format> 事件重新格式化输入数据以符合掩码，可使用 <xref:System.Windows.Forms.Binding.Parse> 事件重新格式化输出数据以符合数据字段的规范。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-115">The <xref:System.Windows.Forms.Binding.Format> event on a data binding can be used to reformat incoming data to comply with the mask, and the <xref:System.Windows.Forms.Binding.Parse> event can be used to reformat outgoing data to comply with the specifications of the data field.</span></span>

<!-- TODO
For more information, see [MaskedTextBox Control](./controls/maskedtextbox-control-windows-forms.md).-->

## <a name="event-driven-validation"></a><span data-ttu-id="d8d3a-116">事件驱动的验证</span><span class="sxs-lookup"><span data-stu-id="d8d3a-116">Event-driven validation</span></span>

<span data-ttu-id="d8d3a-117">如果要获得对验证的完全编程控制，或者需要复杂的验证检查，则应使用大多数 Windows 窗体控件中内置的验证事件。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-117">If you want full programmatic control over validation, or need complex validation checks, you should use the validation events that are built into most Windows Forms controls.</span></span> <span data-ttu-id="d8d3a-118">每个接受自由格式用户输入的控件都有 <xref:System.Windows.Forms.Control.Validating> 事件，并且控件需要数据验证时会发生该事件。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-118">Each control that accepts free-form user input has a <xref:System.Windows.Forms.Control.Validating> event that will occur whenever the control requires data validation.</span></span> <span data-ttu-id="d8d3a-119">在 <xref:System.Windows.Forms.Control.Validating> 事件处理方法中，可以通过多种方式验证用户输入。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-119">In the <xref:System.Windows.Forms.Control.Validating> event-handling method, you can validate user input in several ways.</span></span> <span data-ttu-id="d8d3a-120">例如，如果文本框必须包含邮政编码，则可以通过以下方式进行验证：</span><span class="sxs-lookup"><span data-stu-id="d8d3a-120">For example, if you have a text box that must contain a postal code, you can do the validation in the following ways:</span></span>

- <span data-ttu-id="d8d3a-121">如果邮政编码必须属于特定的邮政编码组，则可以对输入进行字符串比较，以验证用户输入的数据。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-121">If the postal code must belong to a specific group of zip codes, you can do a string comparison on the input to validate the data entered by the user.</span></span> <span data-ttu-id="d8d3a-122">例如，如果邮政编码必须属于集合 `{10001, 10002, 10003}`，则可以进行字符串比较来验证数据。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-122">For example, if the postal code must be in the set `{10001, 10002, 10003}`, then you can use a string comparison to validate the data.</span></span>

- <span data-ttu-id="d8d3a-123">如果邮政编码必须采用特定格式，则可以使用正则表达式来验证用户输入的数据。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-123">If the postal code must be in a specific form, you can use regular expressions to validate the data entered by the user.</span></span> <span data-ttu-id="d8d3a-124">例如，若要验证格式 `#####` 或 `#####-####`，可以使用正则表达式 `^(\d{5})(-\d{4})?$`。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-124">For example, to validate the form `#####` or `#####-####`, you can use the regular expression `^(\d{5})(-\d{4})?$`.</span></span> <span data-ttu-id="d8d3a-125">若要验证格式 `A#A #A#`，可以使用正则表达式 `[A-Z]\d[A-Z] \d[A-Z]\d`。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-125">To validate the form `A#A #A#`, you can use the regular expression `[A-Z]\d[A-Z] \d[A-Z]\d`.</span></span> <span data-ttu-id="d8d3a-126">有关正则表达式的详细信息，请参阅 [.NET 正则表达式](/dotnet/standard/base-types/regular-expressions)和[正则表达式示例](/dotnet/standard/base-types/regular-expression-example-scanning-for-hrefs)。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-126">For more information about regular expressions, see [.NET Regular Expressions](/dotnet/standard/base-types/regular-expressions) and [Regular Expression Examples](/dotnet/standard/base-types/regular-expression-example-scanning-for-hrefs).</span></span>

- <span data-ttu-id="d8d3a-127">如果邮政编码必须是有效的美国邮政编码，则可以调用邮政编码 Web 服务来验证用户输入的数据。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-127">If the postal code must be a valid United States Zip code, you could call a Zip code Web service to validate the data entered by the user.</span></span>

<span data-ttu-id="d8d3a-128"><xref:System.Windows.Forms.Control.Validating> 事件由类型为 <xref:System.ComponentModel.CancelEventArgs> 的对象提供。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-128">The <xref:System.Windows.Forms.Control.Validating> event is supplied an object of type <xref:System.ComponentModel.CancelEventArgs>.</span></span> <span data-ttu-id="d8d3a-129">如果确定控件的数据无效，可将此对象的 <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> 属性设置为 `true`，以取消 <xref:System.Windows.Forms.Control.Validating> 事件。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-129">If you determine that the control's data isn't valid, cancel the <xref:System.Windows.Forms.Control.Validating> event by setting this object's <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property to `true`.</span></span> <span data-ttu-id="d8d3a-130">如果未设置 <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> 属性，则 Windows 窗体将假定针对该控件的验证成功，并引发 <xref:System.Windows.Forms.Control.Validated> 事件。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-130">If you don't set the <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property, Windows Forms will assume that validation succeeded for that control and raise the <xref:System.Windows.Forms.Control.Validated> event.</span></span>

<span data-ttu-id="d8d3a-131">有关对 <xref:System.Windows.Controls.TextBox> 中的电子邮件地址进行验证的代码示例，请参阅 <xref:System.Windows.Forms.Control.Validating> 事件参考。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-131">For a code example that validates an email address in a <xref:System.Windows.Controls.TextBox>, see the <xref:System.Windows.Forms.Control.Validating> event reference.</span></span>

### <a name="event-driven-validation-data-bound-controls"></a><span data-ttu-id="d8d3a-132">事件驱动的验证数据绑定控件</span><span class="sxs-lookup"><span data-stu-id="d8d3a-132">Event-driven validation data-bound controls</span></span>

<span data-ttu-id="d8d3a-133">将控件绑定到数据源（例如数据库表）时，验证很有用。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-133">Validation is useful when you have bound your controls to a data source, such as a database table.</span></span> <span data-ttu-id="d8d3a-134">通过使用验证，可确保控件的数据符合数据源所需的格式，并可确保其不包含任何不安全的特殊字符，例如引号和反斜杠。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-134">By using validation, you can make sure that your control's data satisfies the format required by the data source, and that it doesn't contain any special characters such as quotation marks and back slashes that might be unsafe.</span></span>

<span data-ttu-id="d8d3a-135">使用数据绑定时，控件中的数据会在 <xref:System.Windows.Forms.Control.Validating> 事件执行期间与数据源同步。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-135">When you use data binding, the data in your control is synchronized with the data source during execution of the <xref:System.Windows.Forms.Control.Validating> event.</span></span> <span data-ttu-id="d8d3a-136">如果取消 <xref:System.Windows.Forms.Control.Validating> 事件，则数据不会与数据源同步。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-136">If you cancel the <xref:System.Windows.Forms.Control.Validating> event, the data won't be synchronized with the data source.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d8d3a-137">如果在 <xref:System.Windows.Forms.Control.Validating> 事件之后进行自定义验证，不会影响数据绑定。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-137">If you have custom validation that takes place after the <xref:System.Windows.Forms.Control.Validating> event, it won't affect the data binding.</span></span> <span data-ttu-id="d8d3a-138">例如，如果使用 <xref:System.Windows.Forms.Control.Validated> 事件中的代码尝试取消数据绑定，仍将发生数据绑定。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-138">For example, if you have code in a <xref:System.Windows.Forms.Control.Validated> event that attempts to cancel the data binding, the data binding will still occur.</span></span> <span data-ttu-id="d8d3a-139">在这种情况下，若要在 <xref:System.Windows.Forms.Control.Validated> 事件中执行验证，请将控件的 [`Binding.DataSourceUpdateMode`](xref:System.Windows.Forms.Binding.DataSourceUpdateMode) 属性从 <xref:System.Windows.Forms.DataSourceUpdateMode.OnValidation?displayProperty=nameWithType> 更改为 <xref:System.Windows.Forms.DataSourceUpdateMode.Never?displayProperty=nameWithType>，然后将 `your-control.DataBindings["field-name"].WriteValue()` 添加到验证代码。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-139">In this case, to perform validation in the <xref:System.Windows.Forms.Control.Validated> event, change the control's [`Binding.DataSourceUpdateMode`](xref:System.Windows.Forms.Binding.DataSourceUpdateMode) property from <xref:System.Windows.Forms.DataSourceUpdateMode.OnValidation?displayProperty=nameWithType> to <xref:System.Windows.Forms.DataSourceUpdateMode.Never?displayProperty=nameWithType>, and add `your-control.DataBindings["field-name"].WriteValue()` to your validation code.</span></span>

## <a name="implicit-and-explicit-validation"></a><span data-ttu-id="d8d3a-140">隐式和显式验证</span><span class="sxs-lookup"><span data-stu-id="d8d3a-140">Implicit and explicit validation</span></span>

<span data-ttu-id="d8d3a-141">何时验证控件的数据？</span><span class="sxs-lookup"><span data-stu-id="d8d3a-141">So when does a control's data get validated?</span></span> <span data-ttu-id="d8d3a-142">具体取决于开发人员。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-142">This is up to you, the developer.</span></span> <span data-ttu-id="d8d3a-143">可以根据应用程序的需要使用隐式或显式验证。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-143">You can use either implicit or explicit validation, depending on the needs of your application.</span></span>

### <a name="implicit-validation"></a><span data-ttu-id="d8d3a-144">隐式验证</span><span class="sxs-lookup"><span data-stu-id="d8d3a-144">Implicit validation</span></span>

<span data-ttu-id="d8d3a-145">隐式验证方法在用户输入数据时对其进行验证。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-145">The implicit validation approach validates data as the user enters it.</span></span> <span data-ttu-id="d8d3a-146">通过在按键被按下时读取按键来验证数据，更常见的是，在用户将输入焦点从控件移开时验证数据。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-146">Validate the data by reading the keys as they're pressed, or more commonly whenever the user takes the input focus away from the control.</span></span> <span data-ttu-id="d8d3a-147">如果希望在用户工作时为其提供有关数据的即时反馈，则此方法很有用。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-147">This approach is useful when you want to give the user immediate feedback about the data as they're working.</span></span>

<span data-ttu-id="d8d3a-148">如果要对控件使用隐式验证，则必须将该控件的 <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> 属性设置为 <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange> 或 <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-148">If you want to use implicit validation for a control, you must set that control's <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property to <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange> or <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>.</span></span> <span data-ttu-id="d8d3a-149">如果取消 <xref:System.Windows.Forms.Control.Validating> 事件，则控件的行为将由分配给 <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> 的值决定。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-149">If you cancel the <xref:System.Windows.Forms.Control.Validating> event, the behavior of the control will be determined by what value you assigned to <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A>.</span></span> <span data-ttu-id="d8d3a-150">如果分配了 <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>，则取消事件不会导致发生 <xref:System.Windows.Forms.Control.Validated> 事件。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-150">If you assigned <xref:System.Windows.Forms.AutoValidate.EnablePreventFocusChange>, canceling the event will cause the <xref:System.Windows.Forms.Control.Validated> event not to occur.</span></span> <span data-ttu-id="d8d3a-151">输入焦点将保留在当前控件上，直到用户将数据更改为有效格式。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-151">Input focus will remain on the current control until the user changes the data to a valid format.</span></span> <span data-ttu-id="d8d3a-152">如果分配了 <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>，则取消事件时不会发生 <xref:System.Windows.Forms.Control.Validated> 事件，但焦点仍将更改为下一个控件。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-152">If you assigned <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange>, the <xref:System.Windows.Forms.Control.Validated> event won't occur when you cancel the event, but focus will still change to the next control.</span></span>

<span data-ttu-id="d8d3a-153">将 <xref:System.Windows.Forms.AutoValidate.Disable> 分配给 <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> 属性可完全防止隐式验证。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-153">Assigning <xref:System.Windows.Forms.AutoValidate.Disable> to the <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property prevents implicit validation altogether.</span></span> <span data-ttu-id="d8d3a-154">若要验证控件，必须使用显式验证。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-154">To validate your controls, you'll have to use explicit validation.</span></span>

### <a name="explicit-validation"></a><span data-ttu-id="d8d3a-155">显式验证</span><span class="sxs-lookup"><span data-stu-id="d8d3a-155">Explicit validation</span></span>

<span data-ttu-id="d8d3a-156">显式验证方法可同时验证数据。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-156">The explicit validation approach validates data at one time.</span></span> <span data-ttu-id="d8d3a-157">可以验证数据，以响应用户操作，例如单击“保存”按钮或“下一步”链接 。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-157">You can validate the data in response to a user action, such as clicking a **Save** button or a **Next** link.</span></span> <span data-ttu-id="d8d3a-158">发生用户操作时，可以通过以下方式之一触发显式验证：</span><span class="sxs-lookup"><span data-stu-id="d8d3a-158">When the user action occurs, you can trigger explicit validation in one of the following ways:</span></span>

- <span data-ttu-id="d8d3a-159">调用 <xref:System.Windows.Forms.ContainerControl.Validate%2A> 以验证最后一个控件是否失去焦点。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-159">Call <xref:System.Windows.Forms.ContainerControl.Validate%2A> to validate the last control to have lost focus.</span></span>
- <span data-ttu-id="d8d3a-160">调用 <xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A> 以验证窗体或容器控件中的所有子级控件。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-160">Call <xref:System.Windows.Forms.ContainerControl.ValidateChildren%2A> to validate all child controls in a form or container control.</span></span>
- <span data-ttu-id="d8d3a-161">调用自定义方法，以手动验证控件中的数据。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-161">Call a custom method to validate the data in the controls manually.</span></span>

### <a name="default-implicit-validation-behavior-for-controls"></a><span data-ttu-id="d8d3a-162">控件的默认隐式验证行为</span><span class="sxs-lookup"><span data-stu-id="d8d3a-162">Default implicit validation behavior for controls</span></span>

<span data-ttu-id="d8d3a-163">不同的 Windows 窗体控件的 <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> 属性具有不同的默认值。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-163">Different Windows Forms controls have different defaults for their <xref:System.Windows.Forms.ContainerControl.AutoValidate%2A> property.</span></span> <span data-ttu-id="d8d3a-164">下表显示了最常见的控件及其默认值。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-164">The following table shows the most common controls and their defaults.</span></span>

| <span data-ttu-id="d8d3a-165">控制</span><span class="sxs-lookup"><span data-stu-id="d8d3a-165">Control</span></span>                                        | <span data-ttu-id="d8d3a-166">默认验证行为</span><span class="sxs-lookup"><span data-stu-id="d8d3a-166">Default Validation Behavior</span></span>                                     |
|------------------------------------------------|-----------------------------------------------------------------|
| <xref:System.Windows.Forms.ContainerControl>   | <xref:System.Windows.Forms.AutoValidate.Inherit>                |
| <xref:System.Windows.Forms.Form>               | <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange> |
| <xref:System.Windows.Forms.PropertyGrid>       | <span data-ttu-id="d8d3a-167">Visual Studio 中未公开的属性</span><span class="sxs-lookup"><span data-stu-id="d8d3a-167">Property not exposed in Visual Studio</span></span>                           |
| <xref:System.Windows.Forms.ToolStripContainer> | <span data-ttu-id="d8d3a-168">Visual Studio 中未公开的属性</span><span class="sxs-lookup"><span data-stu-id="d8d3a-168">Property not exposed in Visual Studio</span></span>                           |
| <xref:System.Windows.Forms.SplitContainer>     | <xref:System.Windows.Forms.AutoValidate.Inherit>                |
| <xref:System.Windows.Forms.UserControl>        | <xref:System.Windows.Forms.AutoValidate.EnableAllowFocusChange> |

## <a name="closing-the-form-and-overriding-validation"></a><span data-ttu-id="d8d3a-169">关闭窗体和重写验证</span><span class="sxs-lookup"><span data-stu-id="d8d3a-169">Closing the form and overriding Validation</span></span>

<span data-ttu-id="d8d3a-170">控件保持焦点时，由于其所包含的数据无效，因此无法通过以下常用方法之一关闭父级窗体：</span><span class="sxs-lookup"><span data-stu-id="d8d3a-170">When a control maintains focus because the data it contains is invalid, it's impossible to close the parent form in one of the usual ways:</span></span>

- <span data-ttu-id="d8d3a-171">单击“关闭”按钮。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-171">By clicking the **Close** button.</span></span>
- <span data-ttu-id="d8d3a-172">选择“系统” > “关闭”菜单 。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-172">By selecting the **System** > **Close** menu.</span></span>
- <span data-ttu-id="d8d3a-173">以编程方式调用 <xref:System.Windows.Forms.Form.Close%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-173">By calling the <xref:System.Windows.Forms.Form.Close%2A> method programmatically.</span></span>

<span data-ttu-id="d8d3a-174">但在某些情况下，无论控件中的值是否有效，均建议让用户关闭窗体。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-174">However, in some cases, you might want to let the user close the form regardless of whether the values in the controls are valid.</span></span> <span data-ttu-id="d8d3a-175">可以通过为窗体的 <xref:System.Windows.Forms.Form.FormClosing> 事件创建处理程序来重写验证并关闭仍包含无效数据的窗体。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-175">You can override validation and close a form that still contains invalid data by creating a handler for the form's <xref:System.Windows.Forms.Form.FormClosing> event.</span></span> <span data-ttu-id="d8d3a-176">在事件中，将 <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> 属性设置为 `false`。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-176">In the event, set the <xref:System.ComponentModel.CancelEventArgs.Cancel%2A> property to `false`.</span></span> <span data-ttu-id="d8d3a-177">这将强制关闭窗体。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-177">This forces the form to close.</span></span> <span data-ttu-id="d8d3a-178">有关详细信息及示例，请参阅<xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-178">For more information and an example, see <xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>.</span></span>

> [!NOTE]
> <span data-ttu-id="d8d3a-179">如果以这种方式强制关闭窗体，则会丢失窗体控件中尚未保存的所有数据。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-179">If you force the form to close in this manner, any data in the form's controls that has not already been saved is lost.</span></span> <span data-ttu-id="d8d3a-180">此外，模式窗体在关闭时不会验证控件的内容。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-180">In addition, modal forms don't validate the contents of controls when they're closed.</span></span> <span data-ttu-id="d8d3a-181">你仍可以使用控件验证将焦点锁定在控件上，但不必担心与关闭窗体相关的行为。</span><span class="sxs-lookup"><span data-stu-id="d8d3a-181">You can still use control validation to lock focus to a control, but you don't have to be concerned about the behavior associated with closing the form.</span></span>

## <a name="see-also"></a><span data-ttu-id="d8d3a-182">另请参阅</span><span class="sxs-lookup"><span data-stu-id="d8d3a-182">See also</span></span>

- [<span data-ttu-id="d8d3a-183">使用键盘事件（Windows 窗体 .NET）</span><span class="sxs-lookup"><span data-stu-id="d8d3a-183">Using keyboard events (Windows Forms .NET)</span></span>](events.md)
- <xref:System.Windows.Forms.Control.Validating?displayProperty=nameWithType>
- <xref:System.Windows.Forms.Form.FormClosing?displayProperty=nameWithType>
- <xref:System.Windows.Forms.FormClosingEventArgs?displayProperty=nameWithType>
